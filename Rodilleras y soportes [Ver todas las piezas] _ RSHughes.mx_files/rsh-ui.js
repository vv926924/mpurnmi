window.console||(window.console={warn:function(){},log:function(){},error:function(){}});"function"!==String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});
Array.prototype.map||(Array.prototype.map=function(a,b){var c,d,e;if(null==this)throw new TypeError(" this is null or not defined");var f=Object(this),g=f.length>>>0;if("function"!==typeof a)throw new TypeError(a+" is not a function");1<arguments.length&&(c=b);d=Array(g);for(e=0;e<g;){var h;e in f&&(h=f[e],h=a.call(c,h,e,f),d[e]=h);e++}return d});
Object.keys||(Object.keys=function(){var a=Object.prototype.hasOwnProperty,b=!{toString:null}.propertyIsEnumerable("toString"),c="toString toLocaleString valueOf hasOwnProperty isPrototypeOf propertyIsEnumerable constructor".split(" "),d=c.length;return function(e){if("object"!==typeof e&&("function"!==typeof e||null===e))throw new TypeError("Object.keys called on non-object");var f=[],g;for(g in e)a.call(e,g)&&f.push(g);if(b)for(g=0;g<d;g++)a.call(e,c[g])&&f.push(c[g]);return f}}());
Array.prototype.find||Object.defineProperty(Array.prototype,"find",{value:function(a,b){if(null==this)throw TypeError('"this" is null or not defined');var c=Object(this),d=c.length>>>0;if("function"!==typeof a)throw TypeError("predicate must be a function");for(var e=0;e<d;){var f=c[e];if(a.call(b,f,e,c))return f;e++}},configurable:!0,writable:!0});
(function(){"performance"in window||(window.performance={});if(!("now"in window.performance)){"now"in Date||(Date.now=function(){return(new Date).getTime()});var a=performance.timing&&performance.timing.navigationStart?performance.timing.navigationStart:Date.now();window.performance.now=function(){return Date.now()-a}}})();$(function(){$("body").hasClass("msie8")&&$("body.msie8 *:last-child").addClass("last-child")});body_onload&&$(body_onload);if(body_onunload)$(window).on("unload",body_onunload);function htmlBuild(a,b,c,d){return d?$("<span/>").append($(a,b).html(c)).html():$("<span/>").append($(a,b).html($("<span/>").text(c).html())).html()}function htmlEncode(a){return $("<div/>").text(a).html()}function htmlDecode(a){return $("<div/>").html(a).text()}
function urlParams(a){if(void 0===a||null===a)a=location.search;if("?"==a.charAt(0)||"#"==a.charAt(0))a=a.slice(1);var b={};$.each(a.split("&"),function(){var a=this.split("=");""!=a[0]&&(b[decodeURIComponent(a[0])]=decodeURIComponent((1<a.length?a[1]:"").replace(/\+/g," ")))});return b}function httpsURL(a){if(!/^https:/.test(a))if(/^\//.test(a))a="https://"+location.hostname+a;else throw"Unsupported URL '"+a+"'";return a}
function rshJSON(a,b,c,d,e){d||(d="GET");e&&(a=httpsURL(a));return $.ajax(a,{data:b,type:d.toUpperCase(),dataType:"json",success:c,error:function(a,b,d){c({status:"error",error_code:"UNKNOWN",error_message:d||"Unknown error"},b,a)}})}
function rshDate(a,b,c){c||(c="-");if("string"===typeof a){if(/^\s*$/.test(a))return c;a=/^\d+$/.test(a)?parseInt(a):new Date(Date.parse(a))}if("number"===typeof a){if(0>=a)return c;a=new Date(9999999999<a?a:1E3*a)}if(!a||"object"!==typeof a||!a.getDate||!a.getDate())return c;b&&"rshdate"!=b?"rshtime"==b&&(b="%d/%m/%Y %I:%M %p"):b="%d/%m/%Y";c=function(a){return(10>a?"0":"")+a};var d=a.getHours(),e=0==d||12==d?12:d%12;return b.replace(/%F/g,"%Y-%m-%d").replace(/%r/g,"%I:%M:%S %p").replace(/%T/g,"%H:%M:%S").replace(/%R/g,
"%H:%M").replace(/%d/g,c(a.getDate())).replace(/%m/g,c(a.getMonth()+1)).replace(/%y/g,c(a.getFullYear()%100)).replace(/%Y/g,a.getFullYear()).replace(/%I/g,c(e)).replace(/%H/g,c(d)).replace(/%M/g,c(a.getMinutes())).replace(/%S/g,c(a.getSeconds())).replace(/%p/g,0==d||12<d?"PM":"AM").replace(/%P/g,0==d||12<d?"pm":"am").replace(/%%/g,"%")}function dollars(a,b){return accounting.formatMoney(a,"$",b?2:0,",",".")}
function rshNumber(a,b,c){a=accounting.formatNumber(a,b,",");c&&/\.\d+$/.test(a)&&(a=a.replace(/0+$/g,"").replace(/\.$/,""));return a}function parseBool(a){a=(""+a).toLowerCase();return"on"==a||"true"==a||"1"==a}function clipText(a,b,c){if(null===c||void 0===c)c="\u2026";return null===a||void 0===a?"":a.length<=b?a:a.substr(0,b-c.length)+c}
function datePickerDefaults(){return{dateFormat:"dd/mm/yy",closeText:"Cerrar",prevText:"&#x3C;Ant",nextText:"Sig&#x3E;",currentText:"Hoy",monthNames:"enero febrero marzo abril mayo junio julio agosto septiembre octubre noviembre diciembre".split(" "),monthNamesShort:"ene feb mar abr may jun jul ogo sep oct nov dic".split(" "),dayNames:"domingo lunes martes mi\u00e9rcoles jueves viernes s\u00e1bado".split(" "),dayNamesShort:"dom lun mar mi\u00e9 juv vie s\u00e1b".split(" "),dayNamesMin:"DLMXJVS".split(""),
weekHeader:"Sm",firstDay:1,isRTL:!1,showMonthAfterYear:!1,yearSuffix:""}};$.fn.labelbyname=function(){return this.each(function(){var a=$(this);if(!a.attr("for")){var b=a.attr("data-for-name");if(b){var c=a.closest("form");c.length||(c=a.parent().parent().parent());c=c.find('[name="'+b+'"]').first();if(!c.attr("id")){for(var d=0;20>d;++d){var e=b+"-id"+(0<d?"-"+d:"");if(0==$("#"+e).length){c.attr("id",e);break}}if(!c.attr("id")){console.warn("Unable to generate an id for ",a.get(0)," (name '"+b+"')");return}}a.attr("for",c.attr("id"))}}})};$(function(){$("label[data-for-name]").labelbyname()});Handlebars.registerHelper("dollar",function(a,b){return accounting.formatMoney(a,"$",void 0!=b.hash.precision?b.hash.precision:2,",",".")});Handlebars.registerHelper("number",function(a,b){return rshNumber(a,void 0!=b.hash.precision?b.hash.precision:2,b.hash.optfrac)});Handlebars.registerHelper("unitsize",function(a,b,c){return a&&b&&c&&a.toLowerCase()!=c.toLowerCase()?" ("+c+" x "+b+")":""});
Handlebars.registerHelper("textif",function(a,b,c,d){if("ne"===c||"!="===c)b=(""+b).toLowerCase()!=(""+d).toLowerCase();else if("eq"===c||"="===c||"=="===c)b=(""+b).toLowerCase()==(""+d).toLowerCase();else throw"Unsupported 'selected' opcode '"+c+"'";return b?a:""});
Handlebars.registerHelper("match",function(a,b){var c=b.hash.op||"true",d=b.hash.target||"",e;b.data.switches&&b.data.switches.matched||(e="eq"===c||"=="===c||"="===c?a==d:"ne"===c||"!="===c||"<>"===c?a!=d:"gt"===c||">"===c?a>d:"ge"===c||">="===c?a>=d:"lt"===c||"<"===c?a<d:"le"===c||"<="===c?a<=d:"rx"===c||"~="===c?(new RegExp(d)).test(a):"rn"===c||"~!"===c?!(new RegExp(d)).test(a):"true"===c?a&&"0"!=a:"false"===c?!a||"0"==a:"default"===c?!(b.data.switches&&b.data.switches.matched):!1);return b.data.switches?
(e&&(b.data.switches.matched=!0),c=b.data.switches,b.data.switches=void 0,e=e?b.fn(this):b.inverse(this),b.data.switches=c,e):e?b.fn(this):b.inverse(this)});Handlebars.registerHelper("switch",function(a,b){b||(b=a||{});var c=Handlebars.createFrame(b.data||{});c.switches||(c.switches={});c.switches.matched=!1;return b.fn(this,{data:c})});Handlebars.registerHelper("date",function(a,b){return rshDate(a,b.hash.format||"rshdate")});
Handlebars.registerHelper("datetime",function(a,b){return rshDate(a,b.hash.format||"rshtime")});Handlebars.registerHelper("uricomp",function(a){return new Handlebars.SafeString(encodeURIComponent(a))});Handlebars.registerHelper("json",function(a,b){if(void 0==a)return"";if(b.hash.keep){var c={};b.hash.keep.split(",").forEach(function(b){return c[b]=a[b]});a=c}return JSON.stringify(a)});var TemplateFactory=function(){var a={};return{get:function(b){var c=this,d=b.code;if(!d)throw"No hay c\u00f3digo de plantilla";var e=a[d];if(!e){var f=$("#template-"+d);f.length&&(e=Handlebars.compile(f.html()))}if(!e)return b.loadingOk||console.warn('Remote loading template "'+d+'", pre-loading might be a good idea'),$.get({url:"/api/template-factory.html",data:{code:d},success:function(a,d){return c._receive(a,d,b)},error:function(a,b,c){return console.log("error: status="+b+" message="+c)}}),
null;e&&(a[d]=e);if(b.onready)b.onready(e,b.code);return e},_receive:function(b,c,d){b=Handlebars.compile(b);a[d.code]=b;if(d.onreceive)d.onreceive(b,d.code);if(d.onready)d.onready(b,d.code)}}}();function show_attribute_info(a){a=$(a.type&&a.target?a.target:a);var b=a.attr("data-attribute-uri"),c=a.attr("data-attribute-name"),d=a.attr("data-attribute-value");if(b&&c){var e=$("#attribute-info-popup");e.length||(e=$("<div/>",{id:"attribute-info-popup",style:"display: none"}),$("<div/>",{"class":"x-content"}).appendTo(e),e.appendTo(document.body),e.dialog({resizable:!1,draggable:!0,modal:!0,closeOnEscape:!0}));e.dialog("isOpen")&&e.dialog("close");var f="&return="+encodeURIComponent(location.href),
b=null!=d?"/api/wiki-attribute-value.html?uri="+encodeURIComponent(b)+"&value="+encodeURIComponent(d)+f:"/api/wiki-attribute-info.html?uri="+encodeURIComponent(b)+f;e.find(".x-content").html("").load(b);e.dialog("option","title",null!=d?c+": "+d:c);null==d?e.dialog("option",{width:"670",height:"auto",position:{my:"center top-280",at:"center center",of:window}}):e.dialog("option",{width:"670",height:"auto",position:200>a.offset().left?{my:"left+10 center-20",at:"right top",of:a}:{my:"center top",at:"center bottom+4",
of:a}});e.dialog("open");$(".ui-widget-overlay").on("click",function(){$(".ui-dialog-titlebar-close").trigger("click")})}else dprint("No attribute URI on "+a+"!"),a.removeClass("x-moreinfo").off("click")}
$(function(){$(".attribute-info,.attribute-value-info").addClass("x-moreinfo").on("click",show_attribute_info).on("mouseenter",function(a){var b=$(a.target);clearTimeout(b.data("timer-id"));b.data("timer-id",setTimeout(function(){show_attribute_info(b)},750))}).on("mouseleave",function(a){a=$(a.target);clearTimeout(a.data("timer-id"))})});$(function(){$(".fold-control").each(function(a,b){b=$(b);var c=b.data("content")||b.attr("data-content")||b.next(),c=$(c);b.data("content",c);c.is(":hidden")?b.addClass("fold-control-down").removeClass("fold-control-up"):b.addClass("fold-control-up").removeClass("fold-control-down")}).on("click",function(a){a.preventDefault();a=$(a.target).closest(".fold-control");var b=a.data("content");b&&b.length&&(b.is(":hidden")?(b.slideDown("fast"),a.addClass("fold-control-up").removeClass("fold-control-down")):
(b.slideUp("fast"),a.addClass("fold-control-down").removeClass("fold-control-up")))})});$(function(){var a=$(".rsh-form .x-field-error").find('input[type="text"],input[type="password"],textarea');0==a.length&&(a=$(".action-focus").find('input[type="text"],input[type="password"],textarea'));0==a.length&&(a=$(".action-focus"));0<a.length&&a.first().trigger("focus")});function modal_mask_get(){var a=$("#modal-mask");0==a.length&&(a=$('<div id="modal-mask"/>'),a.appendTo("body"));return a}function modal_mask_show(){modal_mask_get().show()}function modal_mask_hide(){modal_mask_get().hide()};function fmask_needed(){return navigator&&navigator.appName&&-1!=navigator.appName.indexOf("MSIE")&&navigator.appVersion&&5>parseInt(navigator.appVersion)}var popup_fmask;
function fmask_show(a,b){if(fmask_needed()){popup_fmask||(popup_fmask=document.createElement("iframe"),popup_fmask.style.position="absolute",popup_fmask.style.border="none",popup_fmask.style.visibility="hidden","https:"==location.protocol&&(popup_fmask.src="/blank.html"));var c=a.parentNode||document.getElementsByTagName("body")[0];c&&(c.appendChild(popup_fmask),popup_fmask.style.width=a.offsetWidth+"px",popup_fmask.style.height=a.offsetHeight+"px",popup_fmask.style.top=a.style.top?a.style.top:a.offsetTop?
a.offsetTop+"px":"",popup_fmask.style.left=a.style.left?a.style.left:a.offsetLeft?a.offsetLeft+"px":"",popup_fmask.style.zIndex=b||(a.style.zIndex?a.style.zIndex-1:1),popup_fmask.style.visibility="visible")}}function fmask_hide(){popup_fmask&&(popup_fmask.style.visibility="hidden",popup_fmask.parentNode&&popup_fmask.parentNode.removeChild(popup_fmask))}var shown_popup_id;
function popup_show(a,b,c){if(b=document.getElementById(a))return shown_popup_id&&popup_hide(shown_popup_id),b.style.display="block",shown_popup_id=a,fmask_show(b),!1}function popup_hide(a){fmask_hide();document.getElementById(a).style.display="none";shown_popup_id=null;return!1};$(function(){function a(){$("#search-main-input:focus").length||!m||k&&$(k).find(">a").text()===$(m).find(">a").text()||("undefined"!==typeof sl_sliding&&(sl_sliding="off"),clearTimeout(n),clearTimeout(t),p&&$(k).find("ul.nav-l4, ul.nav-l5, ul.nav-l6").hide(),k&&(f(k),$(k).children(".x-show").removeClass("x-show").hide()),q.find(".x-menu-shade").show(),q.addClass("x-left-nav-active"),k=m,e(m,1),$(m).children(".nav-l2-l3").addClass("x-show").show())}function b(){clearTimeout(n);clearTimeout(t);p&&
$(k).find("ul.nav-l4, ul.nav-l5, ul.nav-l6").hide();k&&(f(k),$(k).children(".x-show").removeClass("x-show").hide(),k=void 0);"undefined"!==typeof sl_sliding&&(sl_sliding="on");q.find(".x-menu-shade").hide();q.removeClass("x-left-nav-active")}function c(){clearTimeout(t);u=x;d();3==x&&(y=Math.floor(g(v)/190+1));if($(v).find("> a i").length){var a=r[y+x-3],a={of:v,my:("r"==a?"left":"right")+" top",at:("r"==a?"right"+(3==x?"-1":""):"left")+" top",within:$(v).closest("div.nav-l2-l3"),collision:"flip fit"};
$(v).find("ul.nav-l"+(x+1)).css({display:"block",opacity:"0"}).position(a).position(a).animate({opacity:100},300);p=v}}function d(){p&&(6>u&&(p=w.find("ul.nav-l6").closest("li"),w.find("ul.nav-l6").hide()),5>u&&(p=w.find("ul.nav-l5").closest("li"),w.find("ul.nav-l5").hide()),4>u&&(p=0,w.find("ul.nav-l4").hide()))}function e(a,b){var c="left";3>b?c="right":3==b?c=500<g(a)?"left":"right":3<b&&(c="r"==r[y+b-3]?"right":"left");$(a).addClass("x-select");$(a).find(">a i").html("right"==c?"&#x25ba;":"&#x25c4;")}
function f(a){$(a).removeClass("x-select");$(a).find(">a i").html("&gt;")}function g(a){var b=Math.floor(q.offset().left+200);return Math.floor($(a).offset().left-b)}var h=void 0,l=void 0,m=void 0,k=void 0,n=0,t=0,v=0,x=0,p=0,u=0,A=400,C=400,z=400,y=1,r="rrrrllll".split(""),B=!0;ismobile&&(z=C=A=100);var q=$(".widget-left-nav"),w=$(".widget-left-nav .x-left-nav");if(q.length){w.find("ul.nav-l1 li").append('<div class="nav-l2-l3"><div class="nav-l2-l3-inner"><div class="x-loading">Cargando...</div></div></div>');
var D=w.find("ul.nav-l1"),E={};D.attr("data-release-id")&&(E.release_id=D.attr("data-release-id"));D.attr("data-url-prefix")&&(E.url_prefix=D.attr("data-url-prefix"));$.ajax("/api/nav-menu.html",{data:E,type:"GET",dataType:"html",success:function(b){var c,d;k?c=$(k).find("> a > span").text():m&&(d=$(m).find("> a > span").text());w.html(b);if(c||d)m=k=void 0,w.find("ul.nav-l1 > li > a > span").each(function(){var a=$(this).text();if(c&&a==c||d&&a==d)return m=$(this).closest("li").get(0),!1}),c&&m&&
a()},error:function(a,b,c){console.warn("Unable to load left-nav HTML: ",c)}});$("body").one("mousemove",function(a){0<$(a.target).closest(q).length||(B=!1)});q.on("leftnavshow",function(b,c,d){c||(c=k||m||w.find("ul.nav-l1 > li").get(0));m=c;clearTimeout(l);clearTimeout(h);d?a():h=setTimeout(a,k?150:250)});q.on("leftnavhide",function(a,c){clearTimeout(h);c?b():l=setTimeout(b,A)});q.on("mouseenter",".x-menu-outer ul.nav-l1 > li",function(a){B||q.trigger("leftnavshow",this)});q.on("mouseenter",".x-menu-outer, .x-menu-outer .x-welcome, .x-menu-outer .x-store",
function(a){B||q.trigger("leftnavshow")});q.on("mouseleave",".x-menu-outer",function(a){q.trigger("leftnavhide")});q.on("mouseleave",".x-menu-outer ul.nav-l1 > li, .x-menu-outer .x-welcome, .x-menu-outer .x-store",function(a){B&&(B=!1)});if(ismobile)q.find(".x-menu-shade").on("click",function(a){q.trigger("leftnavhide")});w.on("click","a",function(a){if(ismobile){var b=$(a.target);!b.closest(".x-image").length&&b.closest("a").find("> i").length&&(a.preventDefault(),a.stopPropagation())}});q.on("click",
".x-menu-header",function(a){ismobile&&(a.preventDefault(),k?q.trigger("leftnavhide",!0):q.trigger("leftnavshow",void 0,!0))});w.on("mouseenter","ul.nav-l3 li",function(a){a.stopPropagation();a=0+1*$(this).parent().attr("class").slice(-1);e(this,a);u=0;clearTimeout(t);clearTimeout(n);6!=a&&(v=this,x=a,n=setTimeout(c,C))});w.on("mouseleave","ul.nav-l3 li",function(a){a=0+1*$(this).parent().attr("class").slice(-1);f(this);x=v=0;clearTimeout(n);clearTimeout(t);6!=a&&(u=a,t=setTimeout(d,z))})}});$.widget("ui.dialog",$.ui.dialog,{options:{resizable:!1,draggable:!0,closeText:"Cerrar"},_create:function(){this._super();this._setOptions(this.options)},_setOptions:function(a){if(void 0!==a.buttons||void 0!==a.buttonOk||void 0!==a.buttonCancel){var b=void 0===a.buttonOk?this.options.buttonOk:a.buttonOk,c=void 0===a.buttonCancel?this.options.buttonCancel:a.buttonCancel,d=void 0===a.buttons?this.options.buttons:a.buttons,e,f,d=$.map(d,function(a,d){"function"==typeof a&&(a={text:d,click:a});if("cancel"==
a.type||a.text&&"cancel"==a.text.toLowerCase())e=a,c=!0;else if("ok"==a.type||a.text&&"ok"==a.text.toLowerCase())f=a,b=!0;else return a});b&&(f||(f={}),f.type||(f.type="ok"),f.text||(f.text=this.options.textButtonOk||this.element.attr("data-dialog-text-button-ok")||"OK"),f.click||(f.click=function(){$(this).trigger("dialogok").dialog("close")}));c&&(e||(e={}),e.type||(e.type="cancel"),e.text||(e.text=this.options.textButtonCancel||this.element.attr("data-dialog-text-button-cancel")||"Cancelar"),e.click||
(e.click=function(){$(this).trigger("dialogcancel").dialog("close")}));f&&d.push(f);e&&d.push(e);if(f||e)a.buttons=d}this.options.width&&this.options.width!=$.ui.dialog.prototype.options.width&&"auto"!=this.options.width||((d=this.element.attr("data-dialog-width"))||(d=this.element.find("[data-dialog-width]").attr("data-dialog-width")),d&&(d=parseInt(d,10)),d&&(this.options.width=d));this.options.height&&this.options.height!=$.ui.dialog.prototype.options.height||((d=this.element.attr("data-dialog-height"))||
(d=this.element.find("[data-dialog-height]").attr("data-dialog-height")),d&&(d=parseInt(d,10)),d&&(this.options.height=d));!this.options.title&&(d=this.element.attr("data-dialog-title")||this.element.find("[data-dialog-title]").attr("data-dialog-title"))&&(this.options.title=d);this._super(a)},open:function(){var a=this.element.closest(".ui-dialog");this.options.unstyled||(a.addClass("rsh-dialog"),this.options.title?a.removeClass("rsh-dialog-no-title"):a.addClass("rsh-dialog-no-title"));this._super();
if(this.options.modal)$("body").one("click",".ui-widget-overlay",$.proxy(this.close,this));a.find(".ui-dialog-buttonset button[autofocus],.ui-dialog-buttonset button:first").trigger("focus")},close:function(){this._super();this.options.autoDestroy&&this.destroy()}});$.widget("rsh.prbar",{options:{value:0,max:100,percent:null,className:"rsh-prbar",classNameMax:"rsh-prbar-at-max",classNameMin:"rsh-prbar-at-min",classNameDisabled:"rsh-prbar-disabled",valueClassName:"x-prbar-value"},_create:function(){this._savedHtml=this.element.html();var a=this.element.text(),b=this.element.attr("data-value"),c=this.element.attr("data-max"),d=this.element.attr("data-percent");null!==b&&void 0!==b?this.option({value:b,max:c}):null!==d&&void 0!==d?this.option({percent:d}):/^([\d\.]+)\/([\d\.]+)$/.test(a)?
this.option({value:parseFloat(RegExp.$1),max:parseFloat(RegExp.$2)}):/^([\d\.]+)%?$/.test(a)?this.option({percent:parseFloat(RegExp.$1)}):this.options.percent?this.option({percent:this.options.percent}):this.options.value&&this.option({value:this.options.value});this.element.html("");this.element.addClass(this.options.className);this.element.find("."+this.options.valueClassName).length||(a=$("<span/>").addClass(this.options.valueClassName),this.element.append(a))},_init:function(){this._initialized=
!0;this._render()},_destroy:function(){this.element.html(this._savedHtml);this.element.removeClass(this.options.className);this._super()},_setOption:function(a,b){"max"===a||"value"===a?(this.options.percent=null,b=parseFloat(b),"max"===a&&(b?this.option("disabled",!1):this.option("disabled",!0))):"percent"===a&&(this.options.max=this.options.value=null,b=parseFloat(b));this._super(a,b)},_setOptions:function(a){this._super(a);this._render()},_render:function(){if(this._initialized)if(this.options.value&&
!this.options.max||this.options.disabled)this.element.addClass(this.options.classNameDisabled);else{this.element.removeClass(this.options.classNameDisabled);var a;null==this.options.percent||null!=this.options.value?(a=(this.options.value||0)/(this.options.max||100)*100,this.options.percent=a):a=this.options.percent;var b=a;0>b?b=0:100<b&&(b=100);this.element.find("."+this.options.valueClassName).css({width:b+"%",height:this.element.height()+"px"});0>=a?this.element.addClass(this.options.classNameMin).removeClass(this.options.classNameMax):
100<=a?this.element.addClass(this.options.classNameMax).removeClass(this.options.classNameMin):this.element.removeClass(this.options.classNameMin).removeClass(this.options.classNameMax)}}});$.widget("rsh.printable",{options:{id:"printable-content","class":"visible-print-block",printHiddenClass:"hidden-print",cleanClasses:"ui-dialog-content ui-widget-content"},_init:function(){var a=this;$("body").data("printable-element")?(warn("Already have an active printable area: ",$("body").data("printable-element")),this._failed=!0):($("body").data("printable-element",this.element),$("body > *").each(function(){var b=this.tagName;"SCRIPT"!=b&&"STYLE"!=b&&(b=$(this),b.attr("id")==a.options.id||
b.hasClass(a.options.printHiddenClass)||b.data("printable-"+a.uuid,b.attr("class")).addClass(a.options.printHiddenClass))}),a.update())},_destroy:function(){var a=this;a._failed||($("body > *").filter(':data("printable-'+a.uuid+'")').each(function(){var b=$(this),c=b.data("printable-"+a.uuid);b.attr("class",c)}),$("body").removeData("printable-element"),$("#"+this.options.id).remove())},update:function(){0==$("#"+this.options.id).length&&$("body").append($("<div/>",{id:this.options.id,"class":this.options["class"]}));
$("#"+this.options.id).html(this.element.clone().removeClass(this.options.cleanClasses))}});$.widget("rsh.confirm",{_init:function(){var a=this.element.attr("data-prompt")||this.element.attr("data-message")||this.options.prompt||this.options.message||"\u00bfEst\u00e1 seguro?",b=this.element.attr("data-title")||this.options.title||"",c=this.options.dialogElement;c&&c.length||(c=$("#dialog-confirm"));c.length||(c=$("<div/>",{id:"dialog-confirm"}).appendTo("body"));this._dialog=c;c.hasClass("ui-dialog-content")||c.dialog({resizable:!1,draggable:!0,modal:!0,closeOnEscape:!0,autoOpen:!1,buttons:[{text:"OK",
click:function(){$(this).data("action-confirmed",!0).dialog("close")}},{text:"Cancelar",click:function(){$(this).dialog("close")}}]});this.options.isHtml||this.element.data("is-html")?c.html(a):c.text(a);c.dialog("option","title",b).dialog("option","close",$.proxy(this._close,this));c.data("action-confirmed",!1).dialog("open")},_close:function(){if(this._dialog.data("action-confirmed")){var a=this.element.attr("data-action-url")||this.element.attr("href");a&&"#"!=a?document.location.href=a:this._trigger("yes",
null,this.options)}else this._trigger("no",null,this.options);this.destroy()}});$.widget("rsh.videoPlayer",{options:{platform:null,id:null,title:null,width:720,height:480,resizable:!0,autoplay:!0,loop:!1,brightcoveParams:{accountId:"6056665201001",playerId:"EjddUp91z"},ooyalaParams:{pcode:"dxd2k61EjuXCkdEr2ThVMhSylv2x",playerBrandingId:"ODhiZDcyNjg4Zjg2NWYzNTNkZWY2NmIy",skin:{config:"//player.ooyala.com/static/v4/stable/4.36.2/skin-plugin/skin.json",inline:{responsive:{breakpoints:{},aspectRatio:"none"},controlBar:{logo:{imageResource:{url:""},width:0,height:0}}}}}},globals:{platforms:{}},
_init:function(){var a=this;this.option("title",this.element.attr("title"));var b={platform:"s",id:"s",width:"#",height:"#",resizable:"b",autoplay:"b",loop:"b",title:"s"},c;for(c in b){var d=this.element.attr("data-"+c);if(void 0!=d&&null!=d){switch(b[c]){default:case "s":break;case "#":d=parseInt(d,10);break;case "b":d="true"==d||"yes"==d||"on"==d||"1"==d}this.option(c,d)}}b=this.options.id||this.element.attr("href");if(/ooid[=-](.{32})/.test(b))this.options.id=RegExp.$1,this.options.platform="ooyala";
else if(/:\/\/www\.youtube\.com.*\Wv=(\w+)/i.test(b)||/:\/\/youtu\.be\/(\w+)/i.test(b))this.options.id=RegExp.$1,this.options.platform="youtube";else if(/brightcove\.com\/.*videos\/(\d+)(?:\D|$)/.test(b))this.options.id=RegExp.$1,this.options.platform="brightcove";else if(/vimeo\.com\/(\d+)(?:\D|$)/.test(b)||/vimeo\.com\/manage\/(\d+)(?:\D|$)/.test(b))this.options.id=RegExp.$1,this.options.platform="vimeo";/^(vimeo|ooyala|youtube|brightcove):(.+)$/.test(this.options.id)?(this.options.platform=RegExp.$1,
this.options.id=RegExp.$2):!this.options.platform&&/^[\w-]{32}$/.test(this.options.id)?this.options.platform="ooyala":!this.options.platform&&/^\w{11}$/i.test(this.options.id)?this.options.platform="youtube":!this.options.platform&&/^\d{13}$/.test(this.options.id)?this.options.platform="brightcove":!this.options.platform&&/^\d{9}$/.test(this.options.id)&&(this.options.platform="vimeo");this.options.id?this.options.platform?("vimeo"==this.options.platform&&(this.options.resizable=!1),this.element.attr("href")&&
this.element.attr("href",location.href.replace(/#.*$/,"")+"#autoplay="+this.options.id),this._loading=this._loadPlatform(this.options.platform),this.element.on("click",function(b){b.preventDefault();$(window).data("video-is-active")||(a._createDialog(),a._loading.done(function(){return a._runVideo()}).fail(function(b){return console.warn("Failed loading video platform '"+a.options.platform+"': "+b)}))}),this.options.autoopen?this.element.trigger("click"):1<location.hash.length&&(b=urlParams(location.hash).autoplay)&&
b==this.options.id&&this.element.trigger("click")):console.warn("Unknown video platform for video "+this.options.id+" on element:",this.element):console.warn("No video ID on video player element: ",this.element)},_loadPlatform:function(a){var b=$.Deferred();if(this.globals.platforms[a])return this.globals.platforms[a];this.globals.platforms[a]=b.promise();if("ooyala"==a)0!==$("link#ooyala-skin").length?b.resolve():($("head").append('<link id="ooyala-skin" href="//player.ooyala.com/static/v4/stable/4.36.2/skin-plugin/html5-skin.min.css" rel="stylesheet">'),
$.getScript("//player.ooyala.com/static/v4/stable/4.36.2/core.min.js").done(function(){return $.getScript("//player.ooyala.com/static/v4/stable/4.36.2/video-plugin/main_html5.min.js").done(function(){return $.getScript("//player.ooyala.com/static/v4/stable/4.36.2/skin-plugin/html5-skin.min.js").done(function(){return $.getScript("//player.ooyala.com/static/v4/stable/4.36.2/video-plugin/bit_wrapper.min.js").done(function(){return b.resolve()})})})}));else if("youtube"==a)window.onYouTubeIframeAPIReady=
function(){return b.resolve()},$.getScript("https://www.youtube.com/player_api");else if("brightcove"==a){var c=this.options.brightcoveParams;$.getScript("https://players.brightcove.net/"+c.accountId+"/"+c.playerId+"_default/index.min.js").done(function(){return b.resolve()})}else"vimeo"==a?$.getScript("https://player.vimeo.com/api/player.js").done(function(){return b.resolve()}):b.reject("Unsupported platform");return this.globals.platforms[a]},_createDialog:function(){var a=this;$("body").append('<div id="rsh-video-player"></div>');
$("#rsh-video-player").append('<span class="x-loading">Cargando...</span>');$("#rsh-video-player").dialog({title:a.options.title,width:a.options.width+40+(navigator.userAgent.match(/(iPad)/)?47:0),height:a.options.height+87,resizable:a.options.resizable,modal:!0,open:function(){$(window).data("video-is-active",!0)},close:function(){$(this).remove();switch(a.options.platform){case "ooyala":a._player&&a._player.destroy();var b=$("iframe[name]").filter(function(){return"Ooyala"==$(this).attr("name").substring(0,
6)}),c=b.next("script");b.remove();c.remove();break;case "youtube":a._player&&(a._player.stopVideo(),a._player.destroy());break;case "brightcove":a._player&&a._player.dispose();break;case "vimeo":a._player&&a._player.destroy()}a._player=void 0;$(window).data("video-is-active",!1)}})},_runVideo:function(){switch(this.options.platform){case "ooyala":return this._runVideoOoyala();case "youtube":return this._runVideoYoutube();case "brightcove":return this._runVideoBrightcove();case "vimeo":return this._runVideoVimeo();
default:console.warn("Unable to play video "+this.options.platform+":"+this.options.id)}},_runVideoOoyala:function(){var a=this;OO.ready(function(){var b=$.extend({},a.options.ooyalaParams,{autoplay:a.options.autoplay,loop:a.options.loop});a._player=OO.Player.create("rsh-video-player",a.options.id,b);$("#rsh-video-player").find(".innerWrapper").css({width:"100%",height:"100%"})})},_runVideoYoutube:function(){var a=$("#rsh-video-player").html($("<div/>",{style:"width: 100%; height: 100%"})).find("div").get(0);
this._player=new YT.Player(a,{videoId:this.options.id,playerVars:{autoplay:this.options.autoplay?1:0,loop:0,rel:0,modestbranding:1}})},_runVideoBrightcove:function(){var a=this,b=$("<video-js/>",{id:"bc-video-player","data-video-id":this.options.id,"data-account":this.options.brightcoveParams.accountId,"data-player":this.options.brightcoveParams.playerId,"data-embed":"default",controls:"true","class":"video-js",style:"width: 100%; height: 100%"});$("#rsh-video-player").html(b);this._player=bc("bc-video-player");
if(this.options.autoplay)this._player.on("loadedmetadata",function(){return a._player.play()})},_runVideoVimeo:function(){$("#rsh-video-player").html($("<div/>",{"class":"x-video-player",style:"width: 100%; height: 100%"}));var a={id:this.options.id,autoplay:!1,byline:!1,title:!1,width:$("#rsh-video-player").width(),height:$("#rsh-video-player").height()};this._player=new Vimeo.Player($("#rsh-video-player .x-video-player").get(0),a);this._player.setColor("#cc1d1e")["catch"](function(a){});this.options.autoplay&&
this._player.play()}});
$(function(){var a=urlParams(location.hash).video;a&&$("<div/>").videoPlayer({id:a,autoplay:!0,autoopen:!0});a=!1;try{a=null!=window.frameElement&&"wmCanonicalIframe"!==window.frameElement.id}catch(b){console.log(b)}a||($(".action-video-player").videoPlayer(),$("iframe").each(function(a,c){var d;try{d=$(c).contents().find(".action-video-player"),d.videoPlayer()}catch(e){d=void 0}if(void 0==d||0==d.length)$(c).on("load",function(a){try{d=$(a.target).contents().find(".action-video-player"),d.videoPlayer()}catch(b){console.log("Video player installation error: "+
b)}})}))});$.widget("rsh.dataEdit",{EventNames:{PREFIX:"dataedit",ASSIGN:"assign",VIEWPREPARE:"viewprepare",ERROR:"error",CANCEL:"cancel",SUBMIT:"submit",SAVE:"save",SUCCESS:"success"},options:{inputErrorContainer:".x-input-errors",formErrorContainer:".x-form-errors",errorMessageClass:"x-error-message",inputErrorClass:"x-error",haveData:!1,focusFirstError:!0,formElementInput:".x-field-input,:input",formElementButton:".x-field-button,:button",formElementAll:".x-field-input,.x-field-button,:input,:button"},_create:function(){this.widgetEventPrefix=
this.EventNames.PREFIX;this._data=this.options.dataref?this.options.dataref[0]:{};this.options.view||(this.options.view={})},_init:function(){this.options.view.templateCode?TemplateFactory.get({code:this.options.view.templateCode,onready:$.proxy(function(a){this._template=a;this._prepare()},this)}):this._prepare()},_prepare:function(){this._open()},_open:function(){this.element.data("saved-html",this.element.html());if(this._template){var a=$("<div/>");a.html(this._template($.extend({},this._data,
this.options.view.extras)));a.find("label").labelbyname();a.find("select[data-field-value]").each(function(a,c){c=$(c);c.val(c.attr("data-field-value"))});a.find('input[type="checkbox"]').each(function(a,c){c=$(c);c.prop("checked",c.val()?!0:!1)});this.options.view.prepare&&this.options.view.prepare(a,this._data);this._trigger(this.EventNames.VIEWPREPARE,a);this.element.html("").append(a)}this.options.fields&&$.each(this.options.fields,$.proxy(this._fieldSetup,this));$.each(this._data,$.proxy(this.field,
this));(this._form=this.element.find(":input").first().prop("form"))?this._form=$(this._form):(this.element.wrapInner("<form/>"),this._form=this.element.find("form"));this.options.view.formClass&&this._form.addClass(this.options.view.formClass);this._form.attr("method")||this._form.attr("method","post");this.options.view.dialog?(this._inDialog=!0,this.element.dialog($.extend({modal:!0,resizable:!1,width:"auto",height:"auto",maxWidth:"800",maxHeight:"700",closeOnEscape:!1},this.options.view.dialog)),
this.element.on("dialogbeforeclose.dataedit",$.proxy(function(a){this._cancelling||(this._trigger(this.EventNames.CANCEL),a.preventDefault())},this))):this.element.show();this._addControls();this._form.on("submit.dataedit",$.proxy(function(a){a.preventDefault();this._trigger(this.EventNames.SUBMIT,a)},this));this.element.on("click.dataedit",this.options.formElementButton,$.proxy(this._runControls,this));this.element.on("change.dataedit",this.options.formElementInput,$.proxy(this._runControls,this));
this.element.on("keyup.dataedit keydown.dataedit",this.options.formElementInput,$.proxy(this._runControls,this));this.element.on("validate.dataedit",this.options.formElementInput,$.proxy(this._runControls,this));a={};a[this.EventNames.PREFIX+this.EventNames.ASSIGN]=this._assign;a[this.EventNames.PREFIX+this.EventNames.CANCEL]=this._cancel;a[this.EventNames.PREFIX+this.EventNames.ERROR]=this._error;a[this.EventNames.PREFIX+this.EventNames.SUBMIT]=this._submit;this._on(a);this.options.haveData&&this.validate();
this._inSubmit=!1},_addControls:function(){if(this.options.controls)for(var a=0;a<this.options.controls.length;++a)this._addControl(this.options.controls[a])},_addControl:function(a){this._controls||(this._controls=[]);a=$.extend({},a);if(a.plugin)if("string"===typeof a.plugin){a.pluginName=a.plugin;var b=rsh.DataEditPlugin[a.pluginName];if(!b)throw"No such DataEditPlugin '"+a.pluginName+"'";a.plugin=new b($.extend({controller:this,scope:this.element},a))}else throw"Unsupported plugin type ("+a.plugin+
")";else throw"No 'plugin' option";this._controls.push(a)},_runControls:function(a){var b=$(a.target).closest(this.options.formElementAll);if(!b.prop("disabled")&&("radio"!==b.prop("type")||b.prop("checked"))){var c=(b.attr("name")||"").trim(),d;d="radio"==b.prop("type")?b.val():"checkbox"==b.prop("type")?b.prop("checked")?"1":"0":b.val();b={input:b,name:c,value:d,data:this._data,event:a,controller:this};for(c=0;c<this._controls.length;++c){d=this._controls[c];var e=d.scope?$(a.target).closest(d.scope):
this.element;if(e.length){var f=d.plugin,g=f[a.type];if(g){b.scope=e;b.control=d;try{g.call(f,a,b)}catch(h){b.error=h}}b.error&&(a.preventDefault(),a.stopImmediatePropagation());if(a.isImmediatePropagationStopped())break}}a.isImmediatePropagationStopped()||b.error||(this._trigger(a.type,a,b)||a.preventDefault(),b.error&&(a.preventDefault(),a.stopImmediatePropagation()));b.error?this._trigger(this.EventNames.ERROR,null,$.extend({skipFocus:!0},b)):a.isDefaultPrevented()||"validate"===a.type&&b.name&&
this.data(b.name,b.value,a,b)}},_fieldSetup:function(a,b){var c=this.element.find('[name="'+a+'"]').filter(":input");$.each(b,function(a,b){switch(a){case "minlength":void 0==c.attr("data-field-minlength")&&c.attr("data-field-minlength",b);break;case "maxlength":void 0==c.attr("data-field-maxlength")&&c.attr("data-field-maxlength",b);break;case "minvalue":void 0==c.attr("data-field-minvalue")&&c.attr("data-field-minvalue",b);break;case "maxvalue":void 0==c.attr("data-field-maxvalue")&&c.attr("data-field-maxvalue",
b);break;case "required":if(void 0==c.attr("data-field-required")){c.attr("data-field-required",b);var f=c.closest(".x-field");b?f.addClass("x-field-required"):f.removeClass("x-field-required")}break;case "regex":void 0==c.attr("data-field-regex")&&c.attr("data-field-regex",b);break;case "options":if("SELECT"==c.prop("tagName")){f=c.find("option");0==f.length&&(c.append(htmlBuild("<option/>",{value:""},"Seleccionar")),f=c.find("option"));if(0==f.length||1==f.length&&""==f.first().attr("value"))$.each(b,
function(a,b){var d={};d.value=null==b.value?"":b.value;b.disabled&&(d.disabled="1");c.append(htmlBuild("<option/>",d,b.text||b.value))}),f=c.find("option");var g={};$.each(b,function(a,b){null!=b.value&&(g[b.value]=1)});f.filter(function(){var a=$(this).attr("value");return""!=a&&!g[a]}).detach()}}})},field:function(a,b,c){if(null===b||void 0===b)return this.fieldValue(a);a=this.element.find('[name="'+a+'"]').filter(":input");var d=a.prop("tagName");"INPUT"==d&&"radio"==a.prop("type")?a.each(function(){var a=
$(this),d=a.val()==b;if(a.prop("checked")&&!d||!a.prop("checked")&&d)a.prop("checked",d),c||a.trigger("change")}):"INPUT"==d&&"checkbox"==a.prop("type")?(d=b&&"off"!=b&&"false"!=b&&"0"!=b?!0:!1,a.prop("checked",d).val(d?"1":"0")):a.val()!==b&&(a.val(b),c||a.trigger("change"))},fieldValue:function(a){a=this.element.find('[name="'+a+'"]').filter(":input");var b=a.prop("tagName");a=a.length?"INPUT"==b&&"radio"==a.prop("type")?a.filter(":checked").val():"INPUT"==b&&"checkbox"==a.prop("type")?a.prop("checked")?
1:0:a.val():null;return void 0!==a?a:null},data:function(a,b,c,d){1<arguments.length&&void 0!==b&&(this._data[a]=b,this._trigger(this.EventNames.ASSIGN,c,$.extend({name:a,value:b,controller:this,data:this._data,event:c},d)));if(0==arguments.length)return $.extend({},this._data);var e=this._data[a];return void 0!==e?e:null},submit:function(){this._trigger(this.EventNames.SUBMIT)},clearSubmit:function(){this._inSubmit=!1},success:function(a){this._trigger(this.EventNames.SUCCESS,null,a);this.destroy()},
_assign:function(a,b){},_cancel:function(a,b){a.isDefaultPrevented()||(this._inDialog&&this.element.dialog("isOpen")&&(this._cancelling=!0,this.element.dialog("close")),this.destroy())},_destroy:function(){this.element.off(".dataedit");this._form&&this._form.off(".dataedit");this._inDialog&&this.element.dialog("destroy");this.element.html(this.element.data("saved-html")).removeData("saved-html");this._super()},error:function(a,b){var c;this._inSubmit=!1;!b&&/^([\w-]+)\s*:\s*(.*)$/.test(a)&&(b=RegExp.$1,
a=RegExp.$2);b&&(c=this.element.find(this.options.formElementAll).filter('[name="'+b+'"]'),c.length||(c=null));this._trigger(this.EventNames.ERROR,null,{name:b,value:this.data(b),controller:this,data:this._data,event:null,input:c,error:a})},_error:function(a,b){"string"===typeof b&&(b={error:b});var c=b.error;c&&(this._errorSet(b.input,c),b.skipFocus||this._errorFocus())},_inputErrorContainer:function(a){var b=a.parent().find(this.options.inputErrorContainer);b.length||(b=a.parent().parent().find(this.options.inputErrorContainer));
return b},_errorSet:function(a,b){b&&++this._errorCount;this._inSubmit=!1;var c;a&&(a=$(a),b?a.addClass(this.options.inputErrorClass):a.removeClass(this.options.inputErrorClass),c=this._inputErrorContainer(a));c&&c.length||(c=this.element.find(this.options.formErrorContainer));c&&c.length||(console.warn("There is no place to show an error in. Error: ",b),c=this.options.formErrorContainer,"string"===typeof c?c=c.substr(1):(c="x-form-errors",this.options.formErrorContainer="."+c),c=$("<div/>",{"class":c}),
this.element.prepend(c));var d=!1;c.find("."+this.options.errorMessageClass).each(function(){if($(this).text()==b)return d=!0,!1});d||c.append($("<div/>",{"class":this.options.errorMessageClass}).text(b)).css("visibility","visible")},_errorFocus:function(){this.options.focusFirstError&&this._form.find("."+this.options.inputErrorClass).first().trigger("focus")},clearError:function(a){a=this.element.find(this.options.formElementAll).filter('[name="'+a+'"]');a.removeClass(this.options.inputErrorClass);
this._inputErrorContainer(a).html("").css("visibility","hidden")},clearErrors:function(){this._errorCount=0;this.element.find(this.options.formErrorContainer).html("").css("visibility","hidden");this.element.find(this.options.inputErrorContainer).html("").css("visibility","hidden");this.element.find(this.options.formElementAll).removeClass(this.options.inputErrorClass)},validate:function(){this.clearErrors();this.element.find(this.options.formElementAll).removeClass(this.options.inputErrorClass).trigger("validate");
this._errorFocus()},_submit:function(a,b){this._inSubmit||(this._inSubmit=!0,this.validate(),this._errorCount?this._inSubmit=!1:this._trigger(this.EventNames.SAVE,a,b)&&this._save(a,b))},_save:function(a,b){},_setOptions:function(){console.warn("Modifying options not supported ("+this.widgetFullName+")")},_setOption:function(a,b){console.warn("Modifying options not supported ("+this.widgetFullName+")")},check:function(a,b,c,d){try{var e=this["check"+a];if(!e)throw"INTERNAL: No check method '"+a+"'";
e(b,c,d)}catch(f){c.error||(c.error=f,c.failedCheck=a,c.failedParam=d),b.stopImmediatePropagation(),b.preventDefault()}},checkRequired:function(a,b){if(0==b.value.length)throw"Se requiere un dato";},checkMinLength:function(a,b,c){if(0<b.value.length&&b.value.length<c)throw"Dato es demasiado corto";},checkMaxLength:function(a,b,c){if(b.value.length>c)throw"Dato es demasiado largo";},checkMinValue:function(a,b,c){if(parseFloat(b.value)<c)throw"Dato es demasiado peque\u00f1o";},checkMaxValue:function(a,
b,c){if(parseFloat(b.value)>c)throw"Dato es demasiado grande";},checkRegex:function(a,b,c){"string"===typeof c&&(c=new RegExp(c));if(b.value.length&&!c.test(b.value))throw"Este dato no re\u00fane los requisitos";},checkRegexFail:function(a,b,c){"string"===typeof c&&(c=new RegExp(c));if(b.value.length&&c.test(b.value))throw"Este dato no re\u00fane los requisitos";},checkUppercase:function(a,b,c){c&&(b.value=b.value.toUpperCase(),b.input.val(b.value))}});window.rsh||(window.rsh={});
rsh.DataEditPlugin||(rsh.DataEditPlugin={});rsh.DataEditPlugin.ValidateOnChange=function(a){};$.extend(rsh.DataEditPlugin.ValidateOnChange.prototype,{change:function(a,b){b.input.trigger("validate");a.preventDefault();a.stopImmediatePropagation()}});rsh.DataEditPlugin.ShowMaxLength=function(a){this.errorClass=a.errorClass;!this.errorClass&&a.controller&&(this.errorClass=a.controller.options.inputErrorClass);this.errorClass||(this.errorClass="x-error")};
$.extend(rsh.DataEditPlugin.ShowMaxLength.prototype,{keyup:function(a,b){var c=b.input.attr("data-field-maxlength");c&&b.value.length>c?b.input.addClass(this.errorClass):b.input.removeClass(this.errorClass)}});rsh.DataEditPlugin.Buttons=function(a){this.options=a;this.actions=a.actions?a.actions:{'input[type="submit"]':"submit",'button[type="submit"]':"submit"}};
$.extend(rsh.DataEditPlugin.Buttons.prototype,{click:function(a,b){var c=$(a.target),d;for(d in this.actions)c.closest(d).length&&(a.preventDefault(),b.controller._trigger(this.actions[d],null,b))}});rsh.DataEditPlugin.AttrChecks=function(a){};
$.extend(rsh.DataEditPlugin.AttrChecks.prototype,{validate:function(a,b){var c=b.input,d=c.attr("data-field-required");d&&0!=d&&b.controller.check("Required",a,b);(d=c.attr("data-field-minlength"))&&b.controller.check("MinLength",a,b,d);(d=c.attr("data-field-maxlength"))&&b.controller.check("MaxLength",a,b,d);d=c.attr("data-field-minvalue");void 0!==d&&b.controller.check("MinValue",a,b,d);d=c.attr("data-field-maxvalue");void 0!==d&&b.controller.check("MaxValue",a,b,d);(d=c.attr("data-field-regex"))&&
b.controller.check("Regex",a,b,d);(c=c.attr("data-field-uppercase"))&&b.controller.check("Uppercase",a,b,c)}});$.widget("rsh.cardEdit",$.rsh.dataEdit,{options:{apiURL:"/api/pay-method-control.json",apiParams:{},apiDataName:"methods",type:"card",id:null,view:{templateCode:"card-edit",formClass:"card-edit rsh-form",dialog:{width:"780",height:"auto"}}},_create:function(){this._super();this._apiURL=httpsURL(this.options.apiURL);this._apiParams=this.options.apiParams||{}},_prepare:function(){this.options.view.dialog&&!this.options.view.dialog.title&&(this.options.view.dialog.title=this.options.id?"Editar la Tarjeta de Cr\u00e9dito":
"Agregar una Tarjeta de Cr\u00e9dito");this.options.id?rshJSON(this._apiURL,$.extend({},this._apiParams,{opcode:"get",type:this.options.type,id:this.options.id}),$.proxy(function(a){"success"!=a.status?alert("Unable to load card data to edit"):(a=a[this.options.apiDataName])&&a[0]?(this._data=a[0],this._open()):alert("Received invalid data")},this),null,!0):this._open()},_addControls:function(){this._super();this._addControl({plugin:"Buttons",scope:".x-fieldset-buttons",actions:{".x-button-submit":"submit",
".x-button-cancel":"cancel"}});this._addControl({plugin:"ShowMaxLength",scope:'input[type="text"],input[type="password"],textarea'});this._addControl({plugin:"AttrChecks"});this._addControl({plugin:"Address",scope:".x-fieldset-address"})},_save:function(a){var b=this;$.when(this._data).then($.proxy(this._saveNumber,this)).then($.proxy(this._saveDetails,this)).done(function(a){b.success(a)}).fail(function(a){a=a.error_message||"Unspecified error";var d=a.match(/^(\w+):\s*(.*)$/);d&&d.length?b.error(d[2],
d[1]):b.error(a)})},_saveNumber:function(a){var b=this;return""==a.number||a.number==a.number_safe?$.when(a):$.when().then(function(){var a=$.Deferred();rshJSON("/api/account-control.json",{opcode:"token-tauth",token_type:"ccnum"},function(b){return"success"===b.status?a.resolve(b):a.reject({error_message:"Unable to save card number",req:"tauth",res:b})});return a.promise()}).then(function(c){var d=$.Deferred();rshJSON(c.url,$.extend(c.params,{payload:a.number}),function(c){"success"===c.status?(a.token=
c.token,b._cardNumberSafe(a),d.resolve(a)):d.reject(c)},"POST");return d.promise()})},_saveDetails:function(a){a=$.extend({},this._apiParams,{opcode:"put",type:this.options.type,id:this.options.id},a);var b=$.Deferred();a.number=a.number_safe;delete a.number_safe;rshJSON(this._apiURL,a,function(a){"success"===a.status?b.resolve(a):b.reject(a)},"POST");return b.promise()},_cardNumberSafe:function(a){a=a.number.replace(/\D/g,"");16==a.length?a=a.substring(0,1)+"... .... .... "+a.substring(a.length-
4):15==a.length?a=a.substring(0,1)+"... ...... ."+a.substring(a.length-4):4<a.length?a=a.substring(0,1)+"....."+a.substring(a.length-4):0<a.length&&(a=a.substring(0,1)+".....");this.field("number",a);this.data("number_safe",a);this.data("number",a)}});$.widget("rsh.shiptoEdit",$.rsh.dataEdit,{options:{apiURL:"/api/shipto-control.json",apiParams:{},apiDataName:"shiptos",id:null,billingAddress:null,view:{templateCode:"shipto-edit",formClass:"shipto-edit rsh-form",dialog:{width:"780",height:"auto"}}},_create:function(){this._super();this._apiURL=httpsURL(this.options.apiURL);this._apiParams=this.options.apiParams||{}},_prepare:function(){this.options.view.dialog&&!this.options.view.dialog.title&&(this.options.view.dialog.title=this.options.id?"Editar direcci\u00f3n de env\u00edo":
"Agregar direcci\u00f3n de env\u00edo");this.options.id?$.getJSON(this._apiURL,$.extend({},this._apiParams,{opcode:"get",type:this.options.type,id:this.options.id})).done($.proxy(function(a){"success"!=a.status?alert("No se puede cargar la direcci\u00f3n de env\u00edo para editar"):(a=a[this.options.apiDataName])&&a[0]?(this._data=a[0],this._open()):alert("Datos inv\u00e1lidos recibidos")},this)).fail(function(a,b,c){console.log("error: status="+b+" message="+c);alert("No se puede cargar los datos de direcci\u00f3n de env\u00edo para editar")}):
this._open()},_addControls:function(){this._super();this._addControl({plugin:"Buttons",scope:".x-fieldset-buttons",actions:{".x-button-submit":"submit",".x-button-cancel":"cancel"}});this._addControl({plugin:"ShowMaxLength",scope:'input[type="text"],input[type="password"],textarea'});this._addControl({plugin:"AttrChecks"});this._addControl({plugin:"Address",scope:".x-fieldset-address"});var a=this.element.find('[name="copy_billing"]'),b=a.closest(".x-field");this.options.billingAddress?this.options.billingAddress.line_1?
(a.on("click",$.proxy(this._copyBilling,this)),a.prop("disabled",!1),b.show()):(a.prop("disabled",!0),b.show().attr("title","Billing address not available")):(a.prop("disabled",!0),b.hide())},_copyBilling:function(a){$(a.target).prop("disabled",!0);var b=this;$.each(this.options.billingAddress,function(a,d){b.field(a,d)})},_save:function(a){$.ajax({type:"POST",url:this._apiURL,data:$.extend({},this._apiParams,{opcode:"put",type:this.options.type,id:this.options.id},this._data),success:$.proxy(function(a){if("success"===
a.status)this.success(a);else{a=a.error_message||"Unspecified error";var c=a.match(/^(\w+):\s*(.*)$/);c&&c.length?this.error(c[2],c[1]):this.error(a)}},this),error:$.proxy(function(a,c,d){this.error("An error happened while saving the data. Please try again later or contact us if the error persists.");console.warn("Shipping address save error: status=",c," message=",d)},this)})}});window.rsh||(window.rsh={});rsh.DataEditPlugin||(rsh.DataEditPlugin={});
rsh.DataEditPlugin.Address=function(a){this.options=$.extend({nameCountryCode:"country_code",regionFieldSelector:{CA:".x-fields-ca",MX:".x-fields-mx",US:".x-fields-us","*":".x-fields-int"}},a);this.prefix=a.prefix||"";this.container="string"===typeof a.scope?$(a.controller.element).find(a.scope):$(a.scope);if(!this.container.length)throw"No address form container";var b=this.container.find('[name="'+this.prefix+this.options.nameCountryCode+'"]');if(!b.length)throw"No country element in the address form";
var c=a.controller.data(this.prefix+this.options.nameCountryCode);c||(c="MX",a.controller.data(this.prefix+this.options.nameCountryCode,c));b.val(c);this._country(c)};
$.extend(rsh.DataEditPlugin.Address.prototype,{change:function(a,b){b.name===this.prefix+this.options.nameCountryCode&&this._country(b.value)},validate:function(a,b){b.input.prop("disabled")&&a.preventDefault()},_countrySelectorCurrent:function(a){a||(a=this.country);return a?this.options.regionFieldSelector[this.country]||this.options.regionFieldSelector["*"]:""},_countrySelectorOther:function(a){var b=this._countrySelectorCurrent(a);return $.map(this.options.regionFieldSelector,function(a,d){return a==
b?void 0:a}).join(",")},_country:function(a){a||(a="US");this.country=a.toUpperCase();a=this._countrySelectorCurrent();var b=this._countrySelectorOther();this.container.find(a).show().find("input,select,textarea,button").prop("disabled",!1);this.container.find(b).hide().find("input,select,textarea,button").prop("disabled",!0)}});
$.widget("rsh.addressEditLegacy",{options:{fieldSelector:".x-field"},_create:function(){this._otherCountryElt=this.element.find('[name="other_country"]');this._otherStateElt=this.element.find('[name="other_state"]');this._usStateElt=this.element.find('[name="state"]');if(0==this._usStateElt.length){var a=this;this.element.find("select[name],input[name]").each(function(){var b=$(this).attr("name");if("state"===b||/_state$/.test(b))return a._usStateElt=$(this),!1})}this._otherCountryElt.length&&this._otherStateElt.length&&
this._usStateElt.length?(this._otherIntElt=this.element.find('[name="other_int"]'),this._otherIntElt.length||(this._otherIntElt=$("<input/>",{type:"hidden",name:"other_int",value:"0"}),this.element.append(this._otherIntElt)),"0"!=this._otherIntElt.val()&&this._otherIntElt.val()||this._otherCountryElt.val("US"),this._otherCountryElt.on("change",$.proxy(this._countryChange,this)).trigger("change")):console.warn("The form does not have correctly set up fields")},_countryChange:function(a){"US"==this._otherCountryElt.val()?
(this._otherIntElt.val("0"),this._otherStateElt.prop("disabled",!0).closest(this.options.fieldSelector).hide(),this._usStateElt.prop("disabled",!1).closest(this.options.fieldSelector).show()):(this._otherIntElt.val("1"),this._otherStateElt.prop("disabled",!1).closest(this.options.fieldSelector).show(),this._usStateElt.prop("disabled",!0).closest(this.options.fieldSelector).hide())}});$.widget("rsh.dataList",{options:{apiURL:null,apiParams:{},apiDataName:"list",templateCodePrefix:"data-",templateCode:null,blockContainer:null,blockClass:"x-data-block",blockClassHover:"x-data-block-hover",blockTypeAttr:"data-block-type",blockIdAttr:"data-block-id",blockDataKey:"block-data",actions:{create:{text:"Agregar",action:"edit"},"delete":{text:"Eliminar"},edit:{text:"Editar"},use:{text:"Usar"}},actionTitles:{},actionAllow:{},autoOpen:!0},refresh:function(){if(this._data&&this._dataIsFresh){this._dataIsFresh=
!1;var a=this._data;this._data=a[this.options.apiDataName];this._trigger("loadcomplete",null,a);this.render()}else this._apiURL?rshJSON(this._apiURL,$.extend({},this._apiParams,{opcode:"list"}),$.proxy(function(a){"success"!=a.status?(console.error("Error loading data from "+this._apiURL+": ",a),alert("No se puede cargar los datos. Intente recargar la p\u00e1gina.")):(this._data=a[this.options.apiDataName])?(this._trigger("loadcomplete",null,a),this.render()):(console.error("No data element in '"+
this.options.apiDataName+"' of data:",a),alert("No se puede cargar los datos. Problema interno."))},this)):console.warn("No data and no apiURL, unable to refresh")},render:function(){var a=this._data;this.options.extraDataFirst&&(a=this.options.extraDataFirst.concat(this._data));this.options.extraDataLast&&(a=a.concat(this.options.extraDataLast));this.options.extraData&&(a=this.options.extraData.concat(this._data));if(this.options.templateCode){var b=TemplateFactory.get({code:this.options.templateCode,
onreceive:$.proxy(this.render,this)});if(!b)return}else for(var c=0;c<a.length;++c){var d=a[c];if(!d.type)throw"Invalid data received, no data type";b=TemplateFactory.get({code:this.options.templateCodePrefix+d.type,onreceive:$.proxy(this.render,this)});if(!b)return}if(this.options.autoOpen){for(var e=this._blockContainer.find("."+this.options.blockClass),c=0;c<a.length;++c){var d=a[c],b=TemplateFactory.get({code:this.options.templateCode||this.options.templateCodePrefix+d.type}),b=$(b(d)).addClass(this.options.blockClass).attr(this.options.blockTypeAttr,
d.type).attr(this.options.blockIdAttr,d.id).data(this.options.blockDataKey,d),f=this.options.actionDefault;f&&"string"!==typeof f&&(f=f[d.type]);var d=this._allowedActions(d.type),g=$(),h;for(h in d){var l=d[h],m=this.options.actions[l];if(m){var k=this.options.actionTitles[l]||m.title||"",n=$("<a/>",{href:"#","class":"x-action","data-action":m.action||l,title:k}).text(m.text||l),g=g.add(n);f&&l===f&&(b.addClass(this.options.blockClassHover),b.attr("data-action",m.action||l),b.attr("title",k))}else console.warn("INTERNAL: No action configuration for '"+
l+"'")}g.length?g.appendTo(b.find(".x-actions")):b.find(".x-actions").hide();c<e.length?$(e.get(c)).replaceWith(b):(b.appendTo(this._blockContainer),e=e.add(b))}e.length>a.length&&e.slice(a._length).remove();this._trigger("rendercomplete")}},_blockActionRemove:function(a,b){a.find(".x-actions").find('.x-action[data-action="'+b+'"]').remove();0==a.find(".x-actions .x-action[data-action]").length&&a.find(".x-actions").hide();a.attr("data-action")===b&&a.removeClass(this.options.blockClassHover).removeAttr("data-action").removeAttr("title")},
_create:function(){this.element.on("click.datalist","."+this.options.blockClass,$.proxy(this._click,this));var a=this.widgetEventPrefix.toLowerCase();this.element.on(a+"editbefore.datalist",$.proxy(this._editBefore,this));this.element.on(a+"deletebefore.datalist",$.proxy(this._deleteBefore,this));this.element.on(a+"usebefore.datalist",$.proxy(this._useBefore,this));this.element.on(a+"editdefault.datalist",$.proxy(this._editDefault,this));this.element.on(a+"deletedefault.datalist",$.proxy(this._deleteDefault,
this));this.element.on(a+"usedefault.datalist",$.proxy(this._useDefault,this));this.element.on(a+"loadcomplete.datalist",$.proxy(this._loadComplete,this));this.element.on(a+"rendercomplete.datalist",$.proxy(this._renderComplete,this));this.element.on(a+"deletesuccessdefault.datalist",$.proxy(this._deleteSuccessDefault,this));this.element.on(a+"deleteerrordefault.datalist",$.proxy(this._deleteErrorDefault,this));this._setOptions()},_destroy:function(){this._blockContainer.html(this._blockContainer.data("saved-html")).removeData("saved-html");
this.element.off(".datalist")},_allowedActions:function(a){var b=[],c=this.options.actionAllowAll;if("string"===typeof c)b.push(c);else if(c)for(var d=0;d<c.length;++d)b.push(c[d]);if(this.options.actionAllow)for(a=this.options.actionAllow[a]||{},d=0;d<a.length;++d)b.push(a[d]);return b},_click:function(a){var b=$(a.target);if("A"!=b.prop("tagName")||b.hasClass("x-action")){var c=b.closest("[data-action]").attr("data-action"),b=b.closest("."+this.options.blockClass);if(c&&b.length){a.preventDefault();
var d=b.attr(this.options.blockTypeAttr)||"",e=b.attr(this.options.blockIdAttr)||"",f=b.data(this.options.blockDataKey);this._action(c,a,{type:d,id:e,data:f,element:b})}}},_action:function(a,b,c){this._trigger(a+"before",b,c)&&this._trigger(a,b,c)&&this._trigger(a+"default",b,c)},_useBefore:function(a,b){},_useDefault:function(a,b){},_editBefore:function(a,b){},_editDefault:function(a,b){},_deleteBefore:function(a,b){},_deleteDefault:function(a,b){$("<div/>").confirm().on("confirmyes",$.proxy(function(){if(this._apiURL){var c=
$.extend({},this._apiParams,{opcode:"delete",type:b.type,id:b.id});rshJSON(this._apiURL,c,$.proxy(function(c){this._action("success"==c.status?"deletesuccess":"deleteerror",a,$.extend(c,{input:b}))},this))}else{for(c in this._data)if(this._data[c].type===b.type&&this._data[c].id===b.id){this._data[c].splice(c,1);break}this.render()}},this))},_deleteSuccessDefault:function(a,b){this.refresh()},_deleteErrorDefault:function(a,b){console.error("Error deleting block: ",b);alert("No se puede eliminar el elemento")},
_loadComplete:function(a,b){},_renderComplete:function(a){},_getParams:function(a,b){var c=null,d=this.options;this._blockContainer.find("."+this.options.blockClass).each(function(){var e=$(this),f=e.attr(d.blockTypeAttr)||"",g=e.attr(d.blockIdAttr)||"";if(f===a&&(!b||b===g))return c={type:f,id:g,data:e.data(d.blockDataKey),element:e},!1});return c},_setOptions:function(){this.options.data&&(this._data=this.options.data,this._dataIsFresh=!0);this.options.apiURL&&(this._apiURL=httpsURL(this.options.apiURL),
this._apiParams=this.options.apiParams);this._blockContainer||(this._blockContainer=this.options.blockContainer?$(this.options.blockContainer):this.element,this._blockContainer.data("saved-html",this._blockContainer.html()));this.refresh()}});$.widget("rsh.pmList",$.rsh.dataList,{options:{apiURL:"/api/pay-method-control.json",apiParams:{},apiDataName:"methods",blockClass:"pay-method-box",blockClassHover:"pay-method-box-hover",blockTypeAttr:"data-method-type",blockIdAttr:"data-method-id",blockDataKey:"method-data",templateCode:"pay-method",actionTitles:{"delete":"Eliminar este m\u00e9todo de pago",use:"Usar este m\u00e9todo de pago",edit:"Editar este m\u00e9todo de pago",create:"Agregar una nueva tarjeta"},actionAllow:{},actionDefault:{}},
_setOptions:function(){this.options.editable&&(this.options.actionAllow.card=["delete","edit"],this.options.actionAllow["card-new"]=["create"],this.options.actionDefault["card-new"]="create");this._super()},_useBefore:function(a,b){"card-new"===b.type&&(a.preventDefault(),this._action("edit",a,b))},_editDefault:function(a,b){var c=$("<form/>",{"class":"rsh-form"}).on("dataeditsuccess",$.proxy(function(a,c){this._editSuccess($.extend({},b,c))},this));"card"===b.type?c.cardEdit({apiURL:this._apiURL,
apiParams:this._apiParams,type:b.type,id:b.id}):"card-new"===b.type?c.cardEdit({apiURL:this._apiURL,apiParams:this._apiParams,type:"card",id:null}):console.warn("Don't know how to edit pay-method '"+b.type+"'")},_editSuccess:function(a){this.refresh()},_deleteErrorDefault:function(a,b){"IN_USE_QL"==b.error_code?alert("Esta tarjeta est\u00e1 en uso con una Lista Express, no se puede eliminar"):this._super(a,b)}});$.widget("rsh.shiptoList",$.rsh.dataList,{options:{apiURL:"/api/shipto-control.json",apiParams:{},apiDataName:"shiptos",blockClass:"shipto-box",blockClassHover:"shipto-box-hover",blockTypeAttr:"data-shipto-type",blockIdAttr:"data-shipto-id",blockDataKey:"shipto-data",templateCodePrefix:"shipto-",actionTitles:{"delete":"Eliminar esta direcci\u00f3n de env\u00edo",use:"Use esta direcci\u00f3n de env\u00edo",edit:"Editar esta direcci\u00f3n de env\u00edo",create:"Agregar una nueva direcci\u00f3n de env\u00edo"},
actionAllow:{address:["delete","edit"],"address-new":["create"]}},_editDefault:function(a,b){var c=$("<form/>",{"class":"rsh-form"}).on("dataeditsuccess",$.proxy(function(a,c){this._editSuccess($.extend({},b,c))},this));"address"===b.type?c.shiptoEdit({apiURL:this._apiURL,apiParams:this._apiParams,type:b.type,id:b.id}):"address-new"===b.type?c.shiptoEdit({apiURL:this._apiURL,apiParams:this._apiParams,type:"address",id:null,billingAddress:b.billingAddress}):console.warn("Don't know how to edit address '"+
b.type+"'")},_editSuccess:function(a){this.refresh()},_deleteErrorDefault:function(a,b){"IN_USE_QL"==b.error_code?alert("Esta direcci\u00f3n est\u00e1 en uso por una Lista Express, no se puede eliminar"):this._super(a,b)}});$(function(){var a=$("#tail-cart-view");$("#tail-cart-trigger");var b=$("#tail-cart-drop");0<$(".flag-tail-cart-disabled").length||!b.length?$(".item-draggable").removeClass("item-draggable").addClass("item-draggable-disabled"):($(".item-draggable").parent().on("click",function(a){0<$(a.target).find(".ui-draggable-dragging").length&&(a.stopPropagation(),a.preventDefault())}),itemDraggableSetup($(".item-draggable")),b.droppable({scope:"item",tolerance:"pointer",activate:function(b,d){a.trigger("cartshow",
{sticky:!0})},deactivate:function(a,b){},drop:function(a,b){var e=b.helper.data("items"),f=b.draggable.attr("data-order-add-merge-mode")||b.draggable.closest("[data-order-add-merge-mode]").attr("data-order-add-merge-mode")||b.draggable.closest("form").find('input[name="merge_mode"]').val()||"add";$("body").orderAdd({items:e,mergeMode:f,successAction:"stay",autoSubmit:!0});orderHighlightTail(e)}}),b.on("dragenter",function(a){b.children(".x-drop-inner").fadeIn(150,"linear")}),b.on("dragleave",function(a){b.children(".x-drop-inner").fadeOut(150,
"linear")}))});
function itemDraggableSetup(a){var b=$("#tail-cart-view"),c=$("#tail-cart-trigger"),d=$("#tail-cart-drop");$(a).draggable({scope:"item",scroll:!1,opacity:.9,delay:50,helper:itemDraggableHelper,revert:function(a){if(a&&ismobile){var c=setTimeout(function(){b.data("product-cart-release-timeout",0);b.trigger("cartrelease")},1500);b.data("product-cart-release-timeout",c)}else b.trigger("cartrelease");return a?!1:!0},revertDuration:200,start:function(){d.show();d.data("drag-over",!1)},stop:function(a,b){d.children(".x-drop-inner").hide();
d.hide()},drag:function(a,b){var g=a.pageX,h=a.pageY,l=d.offset(),m=d.width(),k=d.height();g>=l.left&&g<l.left+m&&h>=l.top&&h<l.top+k?d.data("drag-over")||(d.data("drag-over",!0),d.trigger("dragenter"),c.trigger("mouseenter")):d.data("drag-over")&&(d.data("drag-over",!1),d.trigger("dragleave"),c.trigger("mouseleave"))}})}
function itemDraggableHelper(a,b){var c=$(a.target).closest(".item-draggable");0==c.length&&(c=$(a.target));var d=c.attr("data-drag-group"),e;if(d){e='[data-drag-group="'+d+'"][data-product-id]';var d=c.attr("data-drag-scope")||c,f={},d=$(d).find(e).add($(d).filter(e)).filter(function(){var a=$(this).attr("data-product-id");return f[a]?!1:f[a]=!0}),f={};e=c.find(e).add(c.filter(e)).filter(function(){var a=$(this).attr("data-product-id");return f[a]?!1:f[a]=!0})}else e=d=c;var g=[];d.each(function(a){var b=
$(this),c,d;if(b.attr("data-form-seq")){var e=b.attr("data-form-seq");a=b.find('[name="item'+e+'"]').val();c=b.find('[name="quantity'+e+'"]').val()||1;d=b.find('[name="unit'+e+'"]').val();b=b.find('[name="configurable'+e+'"]').val()||""}else a=b.attr("data-product-id"),c=parseInt(b.attr("data-quantity"),10)||1,d=b.attr("data-unit-name"),b=b.attr("data-configurable")||"";a&&g.push({opcode:"add",product_id:a,quantity:c,unit_name:d,configurable:b})});var h=0;e.each(function(a){$(this).attr("data-product-id")&&
++h});var l=c.outerWidth(!1),m=c.outerHeight(!1);m&&l||console.warn("Use item-draggable on visible 'block' level elements. Currently have: ",c);d=c.clone();"TR"==d.prop("nodeName")&&(d=$("<table/>").append(d).addClass(c.closest("table").prop("className")),c.draggable("option","appendTo",c.closest("table").parent()));d.addClass("x-clone").css("margin","0");l&&d.width(l);m&&d.height(m);e=$("<div/>").addClass("x-draggable-wrap").append(d);l&&e.width(l);m&&e.height(m);l=$("<div/>").addClass("item-draggable-helper");
l.append(e);var k;g.length>h&&0<h?(k=g.length-h,k=$("<div/>").addClass("x-draggable-label").text("+"+k+" "+(1<k?"productos m\u00e1s":"producto m\u00e1s"))):1<g.length&&(k=$("<div/>").addClass("x-draggable-label").text(""+g.length+" productos totales"));k&&l.append($("<div/>").addClass("x-draggable-label-anchor").append(k));l.data("items",g);d.find('input[type="radio"]').each(function(){this.name+="-cloned"});var n;c.attr("data-drag-container")&&(n=$(c.attr("data-drag-container")),0==n.length&&(n=
void 0));n||(k=$(c).closest("[data-animate-container]"),0<k.length&&(n=$(k.attr("data-animate-container")),0==n.length&&(n=void 0)));!n&&0<c.closest(".ui-dialog").length&&(n=$("body"));n&&n.length&&l.appendTo(n);return l}
function cartAnimateAdding(a,b){var c=$("#tail-cart-view");a=$(a);if(0!=a.length&&0!=c.length&&!c.data("product-cart-animating")){c.data("product-cart-animating",!0);var d=c.data("product-cart-release-timeout");d&&clearTimeout(d);var e=itemDraggableHelper({target:a}),f=a.offset();b||(b=a.closest(".ui-dialog").length?$("body"):a.parent());$(b).append(e);e.css({position:"absolute",opacity:"0.1"});e.offset(f);c.trigger("cartshow",{sticky:!0});var g=$(".x-cart-line"),h=g.offset().left-f.left+g.width()/
2-e.width()/2,f=g.offset().top-f.top-125;e.animate({left:"+="+h,top:"+="+f,opacity:.9},750,function(){orderHighlightTail(e.data("items"));e.fadeOut(500,function(){e.remove();c.data("product-cart-animating",!1)});d=setTimeout(function(){c.data("product-cart-release-timeout",0);c.trigger("cartrelease")},2E3);c.data("product-cart-release-timeout",d)})}};function orderUpdatePrice(a,b){a=$(a);var c=a.find(".x-unit select").find("option:selected");if(0!=c.length){var d=c.attr("data-price");d&&(a.find(".x-price").text(accounting.formatMoney(d,"$",2,",",".")),c=c.attr("data-total")?accounting.formatMoney(c.attr("data-total"),"$",2,",","."):"\u2014",a.find(".x-item-total").text(c))}}
function orderItemErrorHelp(a){a.preventDefault();$("<div/>").html('<p>Por favor no dude en <a href="/contact/">enviarnos un email</a> o llamarnos -  nuestros especialistas de producto est\u00e1n listos para ayudarle a encontrar una sustituci\u00f3n </p>\n<p>Para quitar un producto del carrito, ponga la cantidad como cero y haga clic en "Actualizar"</p>').dialog({title:"No se puede pedir algunos productos agregados a su carrito",modal:!0,width:400,height:"auto",closeOnEscape:!0,buttonOk:!0})}
function orderRender(a){if(a&&a.status&&"success"==a.status){$("body").data("order-data",a);var b=$(".cart-item-count"),b=parseInt(b.text(),10);0<a.lines.length&&0==b?setCartHighlight(!0):0==a.lines.length&&0<b&&setCartHighlight(!1);$(".cart-item-count").text(a.lines.length);$(".cart-sub-total").text(accounting.formatMoney(a.order.total_items,"$",2,",","."));$(".cart-sub-grand").text(accounting.formatMoney(a.order.total_grand,"$",2,",","."));a.lines.length?($(".cart-content-lines[data-template-code]").each(function(b,
d){d=$(d);TemplateFactory.get({code:d.attr("data-template-code"),onready:function(b){d.html(b(a));d.find(".x-item .x-error .x-error-help-link").show().on("click",orderItemErrorHelp)}})}),$(".cart-content-empty").hide(),$(".cart-content-lines").show(),a.coupons_html?$(".cart-coupons").html(a.coupons_html).show():$(".cart-coupons").html("").hide(),$(".cart-customer-comments").text(a.order.customer_comments).data("saved",a.order.customer_comments).trigger("change"),orderRenderTail(a),orderRenderCart(a),
orderStockStatus(a),$(".cart-content-lines .x-item .x-quantity input").trigger("change"),$("body").trigger("rsh.cartshown",a)):$(".order-content-empty").length?($(".order-content").hide(),$(".order-content-empty").show()):($(".cart-content-lines").hide(),$(".cart-content-empty").show())}}
function orderHighlightTail(a){var b=$("#tail-cart-view");if(b.length)if(a&&1<=a.length){for(var c=[],d=0;d<a.length;d++)c.push(a[d].product_id);b.data("active-product-ids",c)}else b.removeData("active-product-ids")}
function orderRenderTail(a){var b=$("#tail-cart-lines"),c=$("#tail-cart-view .x-scrolling");c.data("jsp")?b.data("item-count")!=a.lines.length&&c.data("jsp").reinitialise():c.jScrollPane({showArrows:!0,maintainPosition:!0});b.data("item-count",a.lines.length);var d=$("#tail-cart-view").data("active-product-ids");if(d){for(var e=void 0,b=0;b<d.length;b++){var f=$('#tail-cart-lines .x-item[data-product-id="'+d[b]+'"]');f.length&&(f.addClass("x-item-active"),f.attr("data-unit-name")||orderUpdatePrice(f,
!0),f=f.offset().left,void 0===e||f<e)&&(e=f)}void 0!==e&&(b=$("#tail-cart-lines").offset().left,c.data("jsp").scrollTo(e-b,0,!0))}if(a.lines.length&&/^\/order\//.test(window.location.pathname)&&!/^\/order\/thanks/.test(window.location.pathname)){c=0;cartStackClearItems();for(b=0;b<a.lines.length;b++){var g=a.lines[b],e=g.sku?g.sku:"",d=g.product_url?g.product_url:"",f=g.image_url_scaled?g.image_url_scaled:"",h=g.name?g.name:"",l=g.order_price?g.order_price:0,m=g.order_quantity?g.order_quantity:0,
g=g.order_unit_name?g.order_unit_name:"",c=c+m*l;cartStackSendItem(e,d,f,h,l,m,g)}cartStackSendTotal(c)}}function cartStackClearItems(){window._cartstack&&window._cartstack.push(["setCartItem",{}])}function cartStackSendItem(a,b,c,d,e,f,g){window._cartstack&&f&&window._cartstack.push(["setCartItem",{quantity:""+f,productID:a?a:"",productName:"",productDescription:d?d:"",productURL:b?b:"",productImageURL:c?c:"",productPrice:e?""+e:"",customFields:{Unit:g?g:""}}])}
function cartStackSendTotal(a){window._cartstack&&(a=accounting.formatNumber(a,2,""),window._cartstack.push(["setCartTotal",a]))}function orderRenderCart(a){}
function tailCartSetup(){var a=$("#tail-cart-trigger");if(a.length){var b=$("#tail-cart-view"),c=b.outerHeight(!0),d=b.parent().outerHeight(!0);b.on("cartshow",function(e,g){0<$(".flag-tail-cart-disabled").length||(g||(g={}),g.sticky&&b.data("is-sticky",!0),b.data("shown")||b.data("animating")||(b.data("animating",!0),b.css({visibility:"visible",bottom:-c+d+"px"}),ismobile&&($(".x-cart-line .x-mobile-icon-open").fadeOut("fast"),$(".x-cart-line .x-mobile-icon-close").fadeIn("fast")),b.animate({bottom:d+
"px"},"fast",function(){b.data("animating",!1);b.data("shown",!0);ismobile||b.trigger(a.data("mouse-in")?"cartshow":"carthide");g.after&&g.after()})))});b.on("cartrelease",function(){b.data("is-sticky",!1);ismobile?b.trigger("carthide"):b.trigger(a.data("mouse-in")?"cartshow":"carthide")});b.on("carthide",function(e){!b.data("shown")||b.data("is-sticky")||b.data("animating")||(b.data("animating",!0),ismobile&&($(".x-cart-line .x-mobile-icon-open").fadeIn("fast"),$(".x-cart-line .x-mobile-icon-close").fadeOut("fast")),
b.animate({bottom:-c+d+"px"},"fast",function(){b.css("visibility","hidden");b.data("animating",!1);b.data("shown",!1);ismobile||b.trigger(a.data("mouse-in")?"cartshow":"carthide")}))});if(ismobile){$(".x-cart-line .x-mobile-icon-open").show();$(".x-cart-line .x-mobile-icon-close").hide();var e=function(a){b.data("shown")&&!$(a.target).closest(".layout-tail-cart").length&&(a.preventDefault(),$(".x-cart-line").trigger("click"))};$(".x-cart-line").on("click",function(a){var c=$(a.target).closest("a");
0<c.length&&!c.hasClass("x-mobile-icon")||(a.preventDefault(),a.stopPropagation(),b.data("shown")?(b.trigger("carthide"),$("body").off("click touchstart",e)):(b.trigger("cartshow"),$("body").on("click touchstart",e)))})}else a.on("mouseenter",function(){a.data("mouse-in",!0);a.data("enter-timer-id",setTimeout(function(){b.trigger("cartshow")},80))}),a.on("mouseleave",function(){a.data("mouse-in",!1);clearTimeout(a.data("enter-timer-id"));b.trigger("carthide")}),a.on("mousedown focus","select",function(a){b.trigger("cartshow",
{sticky:!0})}),a.on("blur","select",function(a){b.trigger("cartrelease")}),b.on("mousewheel",function(a,b){a.preventDefault();var c=$("#tail-cart-view .x-scrolling").data("jsp");c&&c.scrollByX(40*-b)})}}
function orderSaveChanges(a,b){var c={},d=0;$(".cart-content-lines .x-item").each(function(b,e){e=$(e);var f=e.attr("data-product-id");if(f){var m=null!=a&&f==a,k=e.find(".x-update").is(":visible");if(m||k)++d,c["opcode."+d]="set",c["product_id."+d]=f,e.find(".x-saveable").each(function(a,b){b=$(b);var e=b.attr("name");if(!e)throw"Saveable element without a name";var f;f=b.is('input[type="checkbox"]')?b.prop("checked")?1:0:"quantity"==(b.attr("name")||"").toLowerCase()?parseInt(b.val(),10):b.val();
c[e+"."+d]=f}),m&&(c["quantity."+d]=0)}else console.warn("No data-product-id found for click on ",e)});if(b)for(var e in b)++d,c["opcode."+d]="add",$.each(b[e],function(a,b){c[a+"."+d]=b});c.count=d;e=$("textarea.cart-customer-comments");var f;0<e.length&&e.val()!==e.data("saved")&&(c.customer_comments=e.val(),f=!0);if(!c.count&&!f)return $.Deferred().resolve().promise();$("#cart-saving").fadeIn("fast");return rshJSON("/api/order-edit.json",c,orderRender).then(function(){$("#cart-saving").fadeOut("fast")})}
$(function(){tailCartSetup();var a=$(".cart-content-lines");a.on("check",".x-item",function(a,b){var e=$(this),f=!1;e.find(".x-saveable[data-default-value]").each(function(a,b){b=$(b);var c=b.attr("data-default-value");if(b.is('input[type="checkbox"]')){var d=b.prop("checked");if((c=0!=parseInt(""+c,10))&&!d||!c&&d)return f=!0,!1}else if("quantity"==(b.attr("name")||"").toLowerCase()){if(d=parseInt(b.val(),10),d!=parseInt(c,10))return f=!0,!1}else if(d=b.val(),d!=c)return f=!0,!1});e=e.find(".x-update");
f?e.show():e.hide();f&&b&&e.trigger("click")});a.on("keyup change",".x-item .x-saveable",function(a){$(this).closest(".x-item").trigger("check",[13==a.which])});a.on("keyup change",".x-item .x-quantity input",function(a){a=$(this);0<(parseInt(a.val(),10)||0)?a.removeClass("x-error"):a.addClass("x-error")});$(".cart-content-lines").on("change",".x-item .x-unit select",function(a){var b=$(a.target);a=b.closest(".x-item");var b=b.val(),e=a.attr("data-unit-name");orderUpdatePrice(a,b==e)});$(".cart-content-lines").on("click",
".x-item .x-item-configurable-expandable",function(a){a.preventDefault();a=$(a.target).closest(".x-item-configurable-expandable");var b=a.closest(".x-item").find(".x-item-configurable-details");b.is(":visible")?(b.slideUp(),a.removeClass("x-item-configurable-expanded")):(b.slideDown(),a.addClass("x-item-configurable-expanded"))});$(".cart-content-lines").on("change",".x-item .x-similar-select",function(a){a.preventDefault();var b=$(a.target).closest(".x-item"),e=b.data("product-id"),f=b.find(".x-unit select").val(),
g=b.index(),h=$(a.target).prop("selectedIndex"),g=$("body").data("order-data").lines[g],l=$(a.target).data("group-spec"),h=$.grep(g.similar,function(a){return a.spec==l})[0].items[h],m={product_id:h.product_id,unit_name:f,quantity:b.find(".x-quantity input").val()};b.find('.x-controls input[type="checkbox"]').each(function(a,b){b=$(b);m[b.attr("name")]=b.prop("checked")?1:0});var k=h.units;$.grep(k,function(a){return a.name==f}).length?orderSaveChanges(e,[m]):(b=$.grep(g.units,function(a){return a.name==
f})[0],h=h.value,b=htmlBuild("<p/>",{},htmlEncode(l)+" '"+htmlEncode(h)+"' no est\u00e1 disponible en la unidad '"+htmlEncode(b.desc)+"'.")+htmlBuild("<p/>",{},"\u00bfCambiar la unidad a '"+htmlEncode(k[0].desc)+"'?"),$("<div/>").confirm({prompt:b,isHtml:!0,modal:!0}).on("confirmyes",function(){m.unit_name=k[0].name;orderSaveChanges(e,[m])}).on("confirmno",function(){var b=$(a.target).find("option").filter(function(a,b){return b.defaultSelected}).prop("value");$(a.target).val(b)}))});$(".cart-content-lines").on("click",
'.x-stax-exempt input[type="checkbox"]',function(a){!$(a.target).prop("checked")||$("body").data("stax-exempt-warned")||$("body").data("order-data-customer")&&$("body").data("order-data-customer").stax_exemp||($("body").data("stax-exempt-warned",!0),$("#stax-exempt-dialog").dialog({closeOnEscape:!0,modal:!0,buttonOk:!0}))});$(".cart-content-lines").on("click",".x-update,.x-remove",function(a){a.preventDefault();a=0<$(a.target).closest(".x-remove").length?$(a.target).closest(".x-item").attr("data-product-id"):
null;orderSaveChanges(a)});$("#cart-line-items .x-checkout-link").on("click",function(a){0<$(".cart-content-lines .x-update").filter(":visible").length&&(a.preventDefault(),orderSaveChanges(null).then(function(){location.href=$(a.target).closest("a").attr("href")}))});var b=$(".cart-customer-comments-save");$("textarea.cart-customer-comments").on("change keyup",function(a){a=$(a.target);var d=a.val();b.css("visibility",d===a.data("saved")?"hidden":"visible")});b.on("click",function(a){a.preventDefault();
orderSaveChanges(null)});$(".checkout-index .x-button-checkout").on("click",function(a){a.preventDefault();var b=orderSaveChanges(null),e=$("body").data("order-data");if(e.lines&&0!=e.lines.length){for(var f in e.lines)if(e.lines[f].order_error_code){f=$("#checkout-errors-dialog");if(!f.length){console.warn("No #checkout-errors-dialog!");break}f.hasClass("ui-dialog-content")?f.dialog("open"):f.dialog({closeOnEscape:!0,modal:!0,width:f.outerWidth(!0),buttonOk:!0});return}var g=urlParams();if(g.ckreturn)b.then(function(){location.href=
g.ckreturn});else if(e&&e.customer&&e.customer.identified){var h=$(a.target).attr("href");b.then(function(){location.href=h})}else f=$("#checkout-options-dialog"),f.hasClass("ui-dialog-content")?f.dialog("open"):f.dialog({closeOnEscape:!0,modal:!0,width:f.outerWidth(!0)})}else $("#checkout-empty-dialog").dialog({modal:!0,buttonOk:!0})})});
function setCartHighlight(a){a?($("#cart-line-empty").fadeOut("fast"),$("#cart-line-items").fadeIn("fast")):($("#cart-line-empty").fadeIn("fast"),$("#cart-line-items").fadeOut("fast"))}$(function(){try{var a=$("#data-order-initial-content").html();if(a){var b=JSON.parse(a);orderRender(b)}}catch(c){console.warn("Error loading initial order content: ",c)}});
function orderStockStatus(a){if(a&&a.lines.length){var b=$(".order-stock-status");b.length&&(b.on("click","a.x-stock-level-detail",function(a){a.stopPropagation();a.preventDefault();$(this).closest("div.x-stock-levels").find("table.x-stock-level-details").toggle()}),b.on("click",".x-stock-level-details",function(a){a.stopPropagation();a.preventDefault();$(this).closest("div.x-stock-levels").find("table.x-stock-level-details").hide()}),b.on("click","a.x-stock-level-details-more-show",function(a){a.stopPropagation();
a.preventDefault();$(this).closest("div.x-stock-levels").find(".x-stock-level-details-more").toggle();$(this).hide()}),$.each(a.lines,function(b,d){stockStatusRender({product_id:d.product_id,unit_name:d.order_unit_name,quantity:d.order_quantity,warehouse:a.warehouse})}))}}
function stockStatusRender(a){rshJSON("/api/product-stock.json",{product_id:a.product_id,unit_name:a.unit_name,include_estimate:1,include_warehouse:1},function(b){"success"!==b.status?console.error("Stock retrieve error: ",b.error_message):(0<b.stock_free&&(a.warehouse&&$.each(b.stock_warehouse,function(b,d){d.is_customer_whse=d.id===a.warehouse.id}),b.stock_warehouse.sort(function(a,b){return a.is_customer_whse?-1:b.is_customer_whse?1:b.qty-a.qty}),$.each(b.stock_warehouse,function(a,d){10<=a&&(d.hide_warehouse=
!0,b.more_warehouses=!0)}),b.stock_over_quantity=b.stock_free>=a.quantity,b.stock_to_order=a.quantity-b.stock_free,b.order=a),TemplateFactory.get({code:"order-stock-status",onready:function(a){a=a(b);$('.order-stock-status[data-product-id="'+b.product_id+'"]').html(a)}}))})};$.widget("rsh.orderAdd",{options:{autoSubmit:!1,setupFormSubmit:!1,mergeModeDefault:"add",successActionDefault:"cart",warnClass:"order-add-warning",animateElement:null,useCheckboxes:!1},_create:function(){this._setOptions(this.options);this.widgetEventPrefix="orderadd";this._on(this.element,{orderadderror:this._onError,orderaddwarnempty:this._onWarnEmpty,orderaddwarnmerge:this._onWarnMerge,orderaddwarnconfigurable:this._onWarnConfigurable,orderaddwarnitems:this._onWarnItems,orderaddsuccess:this._onSuccess})},
_init:function(){this.options.autoSubmit?this.submit():(this.options.setupFormSubmit||"FORM"==this.element.prop("nodeName"))&&this.setupFormSubmit();!this.options.mergeMode&&this.element.attr("data-merge-mode")&&(this.options.mergeMode=this.element.attr("data-merge-mode"));!this.options.animateElement&&this.element.attr("data-animate-element")&&(this.options.animateElement=this.element.attr("data-animate-element"),this.options.successAction="stay",!this.options.animateContainer&&this.element.attr("data-animate-container")&&
(this.options.animateContainer=this.element.attr("data-animate-container")));!this.options.successAction&&this.element.attr("data-success-action")&&(this.options.successAction=this.element.attr("data-success-action"))},setupFormSubmit:function(){var a=this;this.element.off("submit.orderadd");this.element.on("submit.orderadd",function(b){b.preventDefault();a.submit()})},_getItems:function(){var a=this.options.items;a||(a=this.element);if(!$.isArray(a)){for(var a=$(a).serializeArray(),b={},c=0;c<a.length;++c)b[a[c].name]=
a[c].value;this._useCheckboxes=b.use_checkboxes||this.options.useCheckboxes;a=[];for(c=1;;++c){var d={product_id:b["item"+c]||b["product_id"+c],quantity:parseInt(b["quantity"+c],10)||1,unit_name:b["unit"+c]||b["unit_name"+c]||"",cert_msds:parseBool(b["cert_msds"+c]),cert_mfctr:parseBool(b["cert_mfctr"+c]),cert_rshughes:parseBool(b["cert_rshughes"+c]),configurable:b["configurable"+c]};if(!d.product_id)break;if(this._useCheckboxes){if(!parseBool(b["ck"+c]))continue;if(parseBool(b["skip"+c]))continue}b.hasOwnProperty("stax_taxable"+
c)?d.stax_exempt=!parseBool(b["stax_taxable"+c]):b.hasOwnProperty("stax_exempt"+c)?d.stax_exempt=parseBool(b["stax_exempt"+c]):d.stax_exempt=!1;a.push(d)}b.merge_mode&&(this.options.mergeMode=b.merge_mode);b.success_action&&(this.options.successAction=b.success_action,this.options.animateElement&&"stay"!=this.options.successAction&&(this.options.animateElement=null,this.options.animateContainer=null))}return a},isSubmitting:function(a){return void 0===a?$("body").data("widget-order-add-submitting"):
$("body").data("widget-order-add-submitting",a)},submit:function(a,b){if(!this.isSubmitting()){this.element.find(":submit").prop("disabled",!0);this.isSubmitting(!0);var c=this._getItems();this._trigger("beforesubmit",null,null);$("#tail-cart-view").data("active-product-id",c&&1==c.length?c[0].product_id:"");if(!c||0>=c.length)this._apiProcess({error_code:"NO_ITEMS"});else{var d;if(this.options.animateElement&&!b){var e;e="auto"==this.options.animateElement?this.element.find(".item-draggable").first():
$(this.options.animateElement);e.length?(d=e.parents(".item-draggable"),d.length&&(e=d),cartAnimateAdding(e,this.options.animateContainer),d=650):console.warn("Unable to find animate element: ",this.options.animateElement)}try{d?setTimeout($.proxy(this._apiSend,this,c,a),d):this._apiSend(c,a)}catch(f){"string"===typeof f&&(f={error_code:"ERROR",error_message:f}),this._apiProcess(f)}}}},_apiSend:function(a,b){for(var c={count:a.length,merge_mode:b||this.options.mergeMode||this.options.mergeModeDefault},
d=0;d<a.length;++d){var e=a[d],f="."+(d+1),g;for(g in e)e.hasOwnProperty(g)&&(c[g+f]="boolean"==typeof e[g]?e[g]?"1":"0":e[g]);c["opcode"+f]="add"}rshJSON("/api/order-edit.json",c,$.proxy(this._apiProcess,this),"POST")},_apiProcess:function(a){this.isSubmitting(!1);this.element.find(":submit").prop("disabled",!1);if("success"==a.status){var b=!1,c;for(c in a.lines){var d=a.lines[c];if(d.is_modified&&d.order_error_code){b=!0;break}}b?this._trigger("warnitems",null,a):this._trigger("success",null,a)}else"NO_ITEMS"==
a.error_code?this._trigger("warnempty",null,a):"MERGE_FAIL"==a.error_code?this._trigger("warnmerge",null,a):"CONFIGURABLE_EXISTS"==a.error_code?this._trigger("warnconfigurable",null,a):this._trigger("error",null,a);this._trigger("aftersubmit",null,a)},_onSuccess:function(a,b){a.stopPropagation();if(this._useCheckboxes&&!this.options.items){var c={};$.each(b.lines,function(){this.is_modified&&(c[this.product_id]=!0)});var d=this.element;this.element.find(":input").each(function(){var a=/^(item|product_id)(\d+)/.exec($(this).prop("name"));
a&&c[$(this).val()]&&d.find(':input[name="ck'+a[2]+'"]').prop("checked",!1).trigger("change")})}"cart"==(this.options.successAction||this.options.successActionDefault)?location.href=httpsURL("/order/"):orderRender(b)},_onWarnEmpty:function(a){a.stopPropagation();$("<div/>").addClass(this.options.warnClass).html("Por favor seleccione algunos productos para agregar al carrito.").dialog({modal:!0,resizable:!1,draggable:!0,closeOnEscape:!0,title:"Ning\u00fan producto seleccionado",buttonOk:!0})},_onWarnMerge:function(a,
b){a.stopPropagation();var c=$("<div/>").addClass(this.options.warnClass);TemplateFactory.get({code:"order-add-warnmerge",onready:function(a){c.html(a(b))}});var d=this;c.dialog({modal:!0,resizable:!1,draggable:!0,position:{my:"center top",at:"center center-200",of:window},closeOnEscape:!0,width:500,maxHeight:600,title:"El carrito ya contiene algunos productos",buttons:[{text:"Agregar",title:"Agregar nuevos productos a los productos ya en el carrito.",click:function(a){d.submit("add",!0);$(this).closest(".ui-dialog-content").dialog("close")}},
{text:"Reemplazar",title:"Reemplazar los contenido del carrito con los nuevos productos.",click:function(a){d.submit("replace",!0);$(this).closest(".ui-dialog-content").dialog("close")}},{text:"Cancelar",title:"Dejar al carrito como est\u00e1, no agregue nuevos productos.",click:function(a){$(this).closest(".ui-dialog-content").dialog("close")}}]})},_onWarnConfigurable:function(a,b){a.stopPropagation();var c=$("<div/>").addClass(this.options.warnClass);TemplateFactory.get({code:"order-add-warnconfigurable",
onready:function(a){c.html(a(b))}});var d=this;c.dialog({modal:!0,resizable:!1,draggable:!0,position:{my:"center top",at:"center center-200",of:window},closeOnEscape:!0,width:500,maxHeight:600,buttons:[{text:"Replace",title:"Replace with the new configuration.",click:function(a){d.submit("newcfg",!0);$(this).closest(".ui-dialog-content").dialog("close")}},{text:"Cancel",title:"Leave cart as is.",click:function(a){$(this).closest(".ui-dialog-content").dialog("close")}}]})},_onWarnItems:function(a,
b){a.stopPropagation();var c=$("<div/>").addClass(this.options.warnClass);TemplateFactory.get({code:"order-add-warnitems",onready:function(a){c.html(a(b))}});var d=this;c.dialog({modal:!0,resizable:!1,draggable:!0,position:{my:"center top",at:"center center-200",of:window},closeOnEscape:!0,width:500,maxHeight:600,title:"No se puede pedir algunos productos agregados a su carrito.",buttons:[{text:"Quitar del carrito",title:"Quitar todo producto problem\u00e1tico del carrito.",click:function(a){$(this).closest(".ui-dialog-content").dialog("close");
var c={},g=0,h;for(h in b.lines){var l=b.lines[h];l.is_modified&&l.order_error_code&&(++g,c["opcode."+g]="set",c["product_id."+g]=l.product_id,c["quantity."+g]=0,c["unit_name."+g]=l.order_unit_name)}c.count=g;rshJSON("/api/order-edit.json",c,$.proxy(d._apiProcess,d),"POST");d._trigger("success",a,b)}},{text:"Mantener en el carrito",title:"Mantener los productos en el carrito y administrarlos en la finalizaci\u00f3n.",click:function(a){$(this).closest(".ui-dialog-content").dialog("close");d._trigger("success",
a,b)}}]})},_onError:function(a,b){a.stopPropagation();var c=$("<div/>").addClass(this.options.warnClass);TemplateFactory.get({code:"order-add-error",onready:function(a){c.html(a(b))}});c.dialog({modal:!0,resizable:!1,draggable:!0,position:{my:"center top",at:"center center-200",of:window},closeOnEscape:!0,width:500,maxHeight:600,title:"Error en agregar los productos al carrito",buttonOk:!0})}});$.widget("rsh.orderEdit",{options:{apiURL:"/api/order-edit.json",apiParams:{}},save:function(){return this._saveChanges()},_create:function(){this._super()},_init:function(){if(!this.options.id)if(this.options.data&&this.options.data.order&&this.options.data.order.order_id)this.options.id=this.options.data.order.order_id;else{console.error("Internal error: No order data available for editing");return}this._on(this.element,{"check .x-item":this._onCheckItem,"check .x-customer-comments":this._onCheckComments,
"keyup .x-item .x-saveable":function(a){$(a.target).closest(".x-item").trigger("check",[13==a.which])},"change .x-item .x-saveable":function(a){$(a.target).closest(".x-item").trigger("check")},"keyup .x-customer-comments .x-saveable":function(a){$(a.target).closest(".x-customer-comments").trigger("check")},"change .x-customer-comments .x-saveable":function(a){$(a.target).closest(".x-customer-comments").trigger("check")},"change .x-item .x-quantity input":this._onQuantityChange,"keyup .x-item .x-quantity input":this._onQuantityChange,
"click .x-item .x-update":function(a){a.preventDefault();this._saveChanges()},"click .x-item .x-remove":function(a){a.preventDefault();this._saveChanges($(a.target).closest(".x-item").attr("data-product-id"))},"click .x-customer-comments .x-update":function(a){a.preventDefault();this._saveChanges()},"click .x-button-save":function(a){a.preventDefault();this._saveChanges()},"click .x-lines-cart .x-item .x-add-link":this._addCartItem});var a=this.element.find(".x-customer-comments .x-saveable").first();
a.data("saved",a.val()).trigger("change")},_onQuantityChange:function(a){a=$(a.target);0<(parseInt(a.val(),10)||0)?a.removeClass("x-error"):a.addClass("x-error")},_onCheckItem:function(a,b){var c=$(a.target).closest(".x-item"),d=!1;c.find(".x-saveable[data-default-value]").each(function(a,b){b=$(b);var c=b.attr("data-default-value");if(b.is('input[type="checkbox"]')){var h=b.prop("checked");if((c=0!=parseInt(""+c,10))&&!h||!c&&h)return d=!0,!1}else if("quantity"==(b.attr("name")||"").toLowerCase()){if(h=
parseInt(b.val(),10),h!=parseInt(c,10))return d=!0,!1}else if(h=b.val(),h!=c)return d=!0,!1});c=c.find(".x-update");d?c.show():c.hide();d&&b&&c.trigger("click")},_onCheckComments:function(a){var b=$(a.target).closest(".x-customer-comments");a=b.find(".x-saveable").first();var c=a.val(),b=b.find(".x-update");c===a.data("saved")?b.hide():b.show()},_saveChanges:function(a,b){var c={order_id:this.options.id},d=0;this.element.find(".x-item").each(function(b,e){e=$(e);var f=e.attr("data-product-id");if(f){var m=
null!=a&&f==a,k=e.find(".x-update").is(":visible");if(m||k)++d,c["opcode."+d]="set",c["product_id."+d]=f,e.find(".x-saveable").each(function(a,b){b=$(b);var e=b.attr("name");if(!e)throw"Saveable element without a name";var f;f=b.is('input[type="checkbox"]')?b.prop("checked")?1:0:"quantity"==(b.attr("name")||"").toLowerCase()?parseInt(b.val(),10):b.val();c[e+"."+d]=f}),m&&(c["quantity."+d]=0)}else console.warn("No data-product-id found for click on ",e)});if(b)for(var e in b)++d,c["opcode."+d]="add",
$.each(b[e],function(a,b){c[a+"."+d]=b});c.count=d;e=this.element.find(".x-customer-comments .x-saveable").first();var f;0<e.length&&e.val()!==e.data("saved")&&(c.customer_comments=e.val(),f=!0);return c.count||f?rshJSON(this.options.apiURL,$.extend({},this.options.apiParams,c),$.proxy(this._saveComplete,this),"POST",!0):(this._trigger("saved",null,null),$.Deferred().resolve().promise())},_saveComplete:function(a){"success"!=a.status?alert("Error saving PM order changes. Please contact support."):
this._trigger("saved",null,a)},_addCartItem:function(a){a.preventDefault();var b=$(a.target).closest(".x-item");a=b.attr("data-product-id");var c=b.find("[data-unit-name]").attr("data-unit-name"),d=b.find("[data-quantity]").attr("data-quantity");if(a&&c&&d){var e=b.find("[data-stax-exempt]").attr("data-stax-exempt"),f=b.find("[data-cert-msds]").attr("data-cert-msds");b.find("[data-cert-mfctr]").attr("data-cert-mfctr");b=b.find("[data-cert-rshughes]").attr("data-cert-rshughes");this._trigger("added",
null,{product_id:a,unit_name:c,quantity:d});this._saveChanges(null,[{product_id:a,unit_name:c,quantity:d,stax_exempt:e,cert_msds:f,cert_rshughes:b}])}else console.warn("Invalid item data, cannot add to order")}});$.widget("rsh.orderView",{options:{apiURL:"/api/order-view.json",apiParams:{},templateCode:"order-view-default"},_create:function(){this._super();this._process()},_setOptions:function(a){this._super(a);this._process()},_process:function(){this.options.orderElement?(this._orderElement=this.element.find(this.options.orderElement),this._orderElement.length||(console.error("Unable to find element '"+this.options.orderElement+"'"),this._orderElement=this.element)):this._orderElement=this.element;if(this.options.data)this._ready($.extend({status:"success"},
this.options.data));else if(this.options.id)this._retrieve();else throw"No order data and no order ID, nothing to show";},_retrieve:function(){void 0===this.options.id?console.warn("No order id given"):rshJSON(this.options.apiURL,$.extend({},this.options.apiParams,{id:this.options.id,key:this.options.key}),$.proxy(this._ready,this),"GET",!0)},_ready:function(a){"success"!==a.status?(console.error("An error happened retrieving order data: ",a.error_message),this._trigger("error",null,a)):(this._orderElement.html(""),
rshEachOrder(a,this.options.external,$.proxy(function(a){this._render(a);this._trigger("ready",null,a)},this)))},_render:function(a){var b=this;TemplateFactory.get({code:this.options.templateCode,onready:function(c){b._orderElement.append(c(a));b.element.find(".x-pm-graph").prbar();b._trigger("render",null,a)}})}});
function rshEachOrder(a,b,c){a="split"==a.order.status&&a.order.related_orders?a.order.related_orders:[a];for(var d=0;d<a.length;++d){var e=$.extend({},a[d]);e.external=b||{};e.external.order_seqno=d+1;e.external.order_seqtotal=a.length;e.external.order_seqfirst=0==d;e.external.order_seqlast=d+1>=a.length;e.external.order_data=$.map(a,function(a){return a.order});c(e)}};$.widget("rsh.checkoutBilling",$.rsh.pmList,{options:{apiURL:"/api/pay-method-control.json",apiParams:{submode:"checkout"},editable:!0,actionAllowAll:"use",actionDefault:"use",blockContainer:".x-methods-container",formElement:"form.x-billing-form",currentContainer:".x-current-method-container",currentType:null,currentId:null,currentData:null},_create:function(){this.formElement=$(this.options.formElement);this.formElement.dataEdit({controls:[{plugin:"Buttons",scope:".x-fieldset-buttons",actions:{".x-button-submit":"submit",
".x-button-cancel":"cancel"}},{plugin:"ShowMaxLength",scope:'input[type="text"],input[type="password"],textarea'},{plugin:"AttrChecks"}]});this.formElement.on("dataeditvalidate",$.proxy(this._validateField,this)).on("dataeditsave",$.proxy(this._saveData,this));this.currentContainer=$(this.options.currentContainer);this.currentDefaultHtml=this.currentContainer.html();this._super()},_validateField:function(a,b){"po"===b.name&&"po"===this.options.currentType&&(b.value||b.controller.error("Se requiere el n\u00famero de orden de compra (PO)",
b.name))},_saveData:function(a,b){if(this.options.currentType&&this.options.currentData){var c=this.formElement.attr("data-success-url");c?rshJSON("/api/order-checkout.json",{opcode:"billing-set",type:this.options.currentType,id:this.options.currentId,po:b.data.po},function(a){"success"!==a.status?b.controller.error(a.error_message||"There was an internal error trying to save the data"):document.location.href=c}):b.controller.error("Internal error: invalid form configuration")}else b.controller.error("Elegir un m\u00e9todo de pago")},
_useDefault:function(a,b){this._setCurrent(b)},_setCurrent:function(a){this.options.currentType=a.type;this.options.currentId=a.id;this.options.currentData=a.data;a=a.element.clone();this._blockActionRemove(a,"use");this.currentContainer.html(a);this.formElement.dataEdit("clearErrors");$("html,body").animate({scrollTop:0},"fast")},_clearCurrent:function(){this.options.currentType=null;this.options.currentId=null;this.options.currentData=null;this.currentContainer.html(this.currentDefaultHtml)},_loadComplete:function(a,
b){this._dataFull=b;b.checkout.allow_billing?(!this.options.currentType&&b.checkout&&(this.options.currentType=b.checkout.method_type,this.options.currentId=b.checkout.method_id),this.formElement.dataEdit("field","po",b.checkout.po)):location.href="/order/"},_renderComplete:function(a){this.element.find(".x-pm-graph").prbar();this.options.currentType&&((a=this._getParams(this.options.currentType,this.options.currentId))?this._setCurrent(a):this._clearCurrent())},_editSuccess:function(a){this.options.currentType=
a.type;this.options.currentId=a.id;this.options.currentData=null;this._super(a)}});$.widget("rsh.checkoutShipping",$.rsh.shiptoList,{options:{apiURL:"/api/shipto-control.json",apiParams:{submode:"checkout"},actionAllowAll:"use",actionDefault:"use",blockContainer:".x-shipto-container",formElement:"form.x-shipping-form",currentContainer:".x-current-shipto-container",shipMethodContainer:".x-shipmethod-container",currentType:null,currentId:null,currentData:null},_create:function(){this.formElement=$(this.options.formElement);this.formElement.dataEdit({controls:[{plugin:"Buttons",scope:".x-fieldset-buttons",
actions:{".x-button-submit":"submit",".x-button-cancel":"cancel"}},{plugin:"ShowMaxLength",scope:'input[type="text"],input[type="password"],textarea'},{plugin:"AttrChecks"}]});this.formElement.on("dataeditvalidate",$.proxy(this._validateField,this)).on("dataeditsave",$.proxy(this._saveData,this));this.formElement.on("change",function(a){a=$(this);var b=a.find("input").filter(function(){var a=$(this);return"shipmethod"===a.prop("name")&&a.prop("checked")});a.find(".x-shipinstr-container-shipmethod-special").css("display",
"none").find(":input").prop("disabled",!0);a.find(".x-shipinstr-container-shipmethod-willcall").css("display","none").find(":input").prop("disabled",!0);"shipmethod-special"!==b.attr("id")&&"shipmethod-willcall"!==b.attr("id")||a.find(".x-shipinstr-container-"+b.attr("id")).css("display","block").find(":input").prop("disabled",!1)});this.currentContainer=$(this.options.currentContainer);this.currentDefaultHtml=this.currentContainer.html();this._super()},_validateField:function(a,b){},_saveData:function(a,
b){if(this.options.currentType&&this.options.currentData){var c=b.data.shipmethod;if(c){var d,e;for(e in this.options.shipMethods){var f=this.options.shipMethods[e];if(f.id===c){d=f;break}}if(d){e="";if("special"===c||"willcall"===c)e=b.data["shipinstr-shipmethod-"+c];if("special"!==d.type||e){var g=this.formElement.attr("data-success-url");g?rshJSON("/api/order-checkout.json",{opcode:"shipping-set",type:this.options.currentType,id:this.options.currentId,shipmethod:c,shipinstr:e},function(a){"success"!==
a.status?b.controller.error(a.error_message||"There was an internal error trying to save the data"):document.location.href=g}):b.controller.error("Internal error: invalid form configuration")}else b.controller.error("Por favor, introduzca un transportista  y un n\u00famero de cuenta")}else console.warn("Internal error: Invalid shipmethod="+c),b.controller.error("Por favor, seleccione un m\u00e9todo de env\u00edo")}else b.controller.error("Por favor, seleccione un m\u00e9todo de env\u00edo")}else b.controller.error("Por favor, indique el destinatario del env\u00edo")},
_action:function(a,b,c){"edit"===a&&"address-new"===c.type&&(c.billingAddress=this.options.billingAddress);this._super(a,b,c)},_useDefault:function(a,b){"address-new"===b.type?(a.preventDefault(),this._action("edit",a,b)):(this._setCurrent(b),this._saveCurrent())},_setCurrent:function(a){this.options.currentType=a.type;this.options.currentId=a.id;this.options.currentData=a.data;this.formElement.dataEdit("clearErrors");a=a.element.clone();this._blockActionRemove(a,"use");this.currentContainer.html(a);
$("html,body").animate({scrollTop:0},"fast")},_saveCurrent:function(){this.element.find(".x-fieldset-shipmethod .x-veil").fadeIn();rshJSON("/api/order-checkout.json",{opcode:"shipping-set",type:this.options.currentType,id:this.options.currentId,submode:"no-shipmethod"},$.proxy(function(a){"success"!==a.status?this.formElement.dataEdit("error",a.error_message||"There was an internal error trying to save the data"):this.refresh()},this))},_clearCurrent:function(){this.options.currentType=null;this.options.currentId=
null;this.options.currentData=null;this.currentContainer.html(this.currentDefaultHtml)},_loadComplete:function(a,b){b.checkout.allow_shipping?(this.options.shipMethods=b.shipmethods,this._renderShipMethods(),this.options.billingAddress=b.checkout.billing_address||{},this.options.currentType||(this.options.currentType=b.checkout.shipto_type,this.options.currentId=b.checkout.shipto_id),this.formElement.dataEdit("fieldValue","shipmethod")||(this.formElement.dataEdit("field","shipmethod",b.checkout.shipmethod_id),
this.formElement.dataEdit("field","shipinstr",b.checkout.shipinstr)),"willcall"!==b.checkout.shipmethod_id&&"special"!==b.checkout.shipmethod_id||this.formElement.dataEdit("field","shipinstr-shipmethod-"+b.checkout.shipmethod_id,b.checkout.shipinstr)):location.href="/order/"},_renderComplete:function(a){this.options.currentType&&((a=this._getParams(this.options.currentType,this.options.currentId))?this._setCurrent(a):this._clearCurrent())},_renderShipMethods:function(){var a=this.options.shipMethods;
if(a){var b=this.formElement.dataEdit("fieldValue","shipmethod"),c=this.formElement.dataEdit("fieldValue","shipinstr"),d=$(this.options.shipMethodContainer);d.html("");for(var e=0;e<a.length;++e){var f="shipmethod-"+a[e].type,g=TemplateFactory.get({code:f,onreceive:$.proxy(this._renderShipMethods,this)});if(!g){console.warn("No pre-loaded template for '"+f+"'");return}}for(e=0;e<a.length;++e)f="shipmethod-"+a[e].type,g=TemplateFactory.get({code:f}),f=g(a[e]),d.append(f);b&&(this.formElement.dataEdit("field",
"shipmethod",b),"willcall"!==b&&"special"!==b||this.formElement.dataEdit("field","shipinstr-shipmethod-"+b,c));this.element.find(".x-fieldset-shipmethod .x-veil").fadeOut();this.formElement.trigger("change")}},_editSuccess:function(a){"address-new"==a.type&&a.id&&(this.options.currentType="address",this.options.currentId=a.id,this.options.currentData=null,this._saveCurrent());this._super(a)}});$.widget("rsh.checkoutReview",{options:{},_create:function(){this._super();this.element.find(this.options.submitElement).on("click",$.proxy(this.submit,this));rshJSON("/api/order-view.json",{submode:"review"},$.proxy(this._render,this),"GET",!0)},_render:function(a){if("success"!==a.status)console.error("An error happened retrieving order data: ",a.error_message),console.warn("Full error data:",a),alert("Error en colecci\u00f3n de informaci\u00f3n de pedido");else if(a.checkout.allow_review){var b=
this.element.find(this.options.linesElement);TemplateFactory.get({code:this.options.linesTemplate,onready:function(c){b.html(c(a))}});var c=this.element.find(this.options.customerElement);TemplateFactory.get({code:this.options.customerTemplate,onready:function(b){c.html(b(a))}});var d=this.element.find(this.options.billingElement);TemplateFactory.get({code:this.options.billingTemplate,onready:function(b){d.html(b(a));d.find(".x-pm-graph").prbar()}});var e=this.element.find(this.options.shippingElement);
TemplateFactory.get({code:this.options.shippingTemplate,onready:function(b){e.html(b(a))}});var f=this.element;this.element.find("a[data-click]").each(function(){var a=$(this).attr("href");f.find($(this).attr("data-click")).css("cursor","pointer").on("click",function(b){$(b.target);"A"!=$(b.target).prop("tagName")&&(b.preventDefault(),location.href=a)})})}else location.href="/order/"},submit:function(a){a&&a.preventDefault();this.element.find(this.options.submitElement).prop("disabled")?console.warn("Duplicate order submit"):
(this.element.find(this.options.submitElement).prop("disabled",!0),this.element.find(this.options.errorElement).html("").hide(),rshJSON("/api/order-checkout.json",{opcode:"submit"},$.proxy(this._submitResult,this)))},_submitResult:function(a){"success"!==a.status?(this.element.find(this.options.errorElement).text(a.error_message||"Error desconocido").show(),this.element.find(this.options.submitElement).prop("disabled",!1)):(a=this.options.successURL.replace("{{id}}",a.order_id).replace("{{key}}",
a.order_key),location.href=httpsURL(a))}});$(function(){$(".newsletter-link").on("click",function(a){a.preventDefault();modal_mask_show();a=$("#newsletter-box");a.length||(a=$("<div/>",{id:"newsletter-box"}).append($("<a/>",{"class":"close-overhang x-close",href:"#",title:"Cerrar"},"Cerrar")).append($("<iframe/>",{src:"/about/newsletter.html",scrolling:"no",marginheight:"0",marginwidth:"0",frameborder:"0"})).appendTo($("body")));0<a.height()&&a.css({left:$(window).width()/2-a.width()/2,top:$(window).height()/2-a.height()/2});a.find(".x-close").add("#modal-mask").one("click",
function(a){a.preventDefault();modal_mask_hide();$("#newsletter-box").hide()});a.show();return!1})});$.widget("rsh.mediaView",{options:{templateCode:"media-view",list:".action-media-view[data-media-id][data-media-mime-short]",format:"wm-700-550-xx/pr-700-550-xx",skipPDF:!0},_init:function(){this._savedHtml=this.element.html();this.element.addClass("rsh-media-view");this.element.html('<div class="x-media-container"></div><div class="x-nav-container"><a href="#" class="x-nav x-nav-prev">&#10094;</a> <a href="#" class="x-nav x-nav-next">&#10095;</a></div>');this._container=this.element.find(".x-media-container");
var a=this;this.element.on("click",".x-nav",function(b){b.preventDefault();$(b.target).hasClass("x-nav-next")?a._currentIndex===a.options.list.length-1?a._currentIndex=0:++a._currentIndex:0===a._currentIndex?a._currentIndex=a.options.list.length-1:--a._currentIndex;0>a._currentIndex&&(a._currentIndex=0);a._currentIndex>a.options.list.length-1&&(a._currentIndex=a.options.list.length-1);b=a.options.list.eq(a._currentIndex);a.option("current",b)});this._setOptions(this.options)},_destroy:function(){this.element.html(this._savedHtml)},
_setOptions:function(a){this._super(a);this.options.current&&(this.options.current=$(this.options.current).filter("[data-media-id][data-media-mime-short]"));this.options.list||(this.options.list=$());"string"===$.type(this.options.list)&&"api:"===this.options.list.substring(0,4)&&(a=this.options.list.substring(4),this.options.list=$(),rshJSON("/api/media-list.json",{item_code:a,mime_short:this.options.skipPDF?"image":""},$.proxy(function(a){if(a.media){var b=$(),e=this.options.current,f=e.attr("data-media-id");
$.each(a.media,function(a,c){if(0<=f.indexOf(c.media_id))b=b.add(e),this._currentIndex=a;else{var l=$("<span/>",{"class":"action-media-view","data-media-id":c.media_id,"data-media-group":e.attr("media-group"),"data-media-mime-short":c.mime_short,"data-media-title":c.title});b=b.add(l)}});this.options.list=b;this._updateNavLinks()}},this)));this.options.list=$(this.options.list).filter("[data-media-id][data-media-mime-short]");if(!this.options.group&&this.options.current){var b=this.options.current.attr("data-media-group");
b&&(this.options.list=this.options.list.filter(function(){return $(this).attr("data-media-group")==b}))}this.options.skipPDF&&(this.options.list=$(this.options.list).not('[data-media-mime-short="pdf"]'));this.options.current||(this.options.current=this.options.list.first());this._updateNavLinks();this._render()},_updateNavLinks:function(){1<this.options.list.length?$(".x-nav-container").show():$(".x-nav-container").hide()},_normalizeMediaId:function(a){return a.replace(/^.*\//,"")},_render:function(){if(this.options.current.length){this.options.list.filter(this.options.current).length||
(this.options.list=this.options.current.add(this.options.list));for(var a=this._normalizeMediaId(this.options.current.attr("data-media-id")),b=this._currentIndex=0;b<this.options.list.length;++b)if(this.options.list.eq(b).attr("data-media-id")==a){this._currentIndex=b;break}var b=this.options.current.attr("data-media-mime-short")||"blob",c=this.options.current.attr("data-media-tag")||"other",d=this.options.current.attr("title");d||(d=this.options.current.children("[title]").attr("title"));d||(d="image"==
b?"Image View":"Document View");var e={id:a,tag:c,title:d,mimeShort:b,format:this.options.format},f=this._container;TemplateFactory.get({code:this.options.templateCode,loadingOk:!0,onready:function(a){f.html(a(e))}})}else console.warn("No media to display")}});$.widget("rsh.labelsEdit",{options:{templateCodeShow:"labels-show",templateCodeEdit:"labels-edit",templateCodeHelp:"labels-help",templateCodeLogin:"labels-login",autoShow:void 0},_create:function(){this.element.data("saved-html",this.element.html());this.element.html("");this.widgetEventPrefix="labelsedit";this._on(this.element,{"click .x-button-edit":this._editDialog,labelseditedit:this._editDialog,"click .x-button-help":this._helpDialog,labelsedithelp:this._helpDialog})},_destroy:function(){this.element.html(this.element.data("saved-html")).removeData("saved-html");
this._super()},_init:function(){this.options.data?this._ready(this.options.data):this._retrieve()},_retrieve:function(){void 0===this.options.query?console.warn("No labels query given"):rshJSON("/api/label-control.json",$.extend({opcode:"find"},this.options.query),$.proxy(this._ready,this),"GET")},_ready:function(a){this._data=$.extend({query:this.options.query},a);"success"!==a.status?("NOT_AUTHORIZED"!==a.error_code&&console.error("An error happened retrieving labels data: ",a.error_message),this._trigger("error",
null,this._data),this._data.labels=[],this._data.items=[]):this._trigger("ready",null,this._data);this._render()},_render:function(){TemplateFactory.get({code:this.options.templateCodeShow,onready:$.proxy(function(a){this.element.html(a(this._data));this._trigger("render",null,this._data);this._secondRender||"labels-edit"!==urlParams().action||this._trigger("edit");this._secondRender=!0;this.options.autoShow&&(this._data.labels.length?$(this.options.autoShow).show():$(this.options.autoShow).hide())},
this)})},_editDialog:function(a){a.preventDefault();"success"!==this._data.status||this._data.anonymous?this._loginDialog(a):TemplateFactory.get({code:this.options.templateCodeEdit,loadingOk:!0,onready:$.proxy(this._editDialogShow,this)})},_editDialogShow:function(a){var b=this,c=$(a(this._data));c.on("click",".x-button-help",$.proxy(function(a){a.preventDefault();this._trigger("help")},this)).dialog({modal:!0,autoDestroy:!0,buttonCancel:!0,buttons:[{text:"Guardar",type:"ok",click:function(a){a=c.find(".x-labels-input").val();
c.find(".x-errors").hide();rshJSON("/api/label-control.json",$.extend({opcode:"update",labels:a},b.options.query),function(a){"success"!==a.status?c.find(".x-errors").find(".x-errors-text").text(a.error_message).end().show():(b._ready(a),b._trigger("change"),c.dialog("close"))},"GET")}}]}).find(".x-labels-input").trigger("focus").end()},_helpDialog:function(a){a.preventDefault();TemplateFactory.get({code:this.options.templateCodeHelp,loadingOk:!0,onready:$.proxy(function(a){$(a(this._data)).dialog({modal:!0,
buttonOk:!0,autoDestroy:!0})},this)})},_loginDialog:function(a){a.preventDefault();var b=location.pathname+"?action=labels-edit";TemplateFactory.get({code:this.options.templateCodeLogin,loadingOk:!0,onready:$.proxy(function(a){$(a($.extend({return_url:b},this._data))).on("click",".x-button-help",$.proxy(function(a){this._trigger("help")},this)).dialog({modal:!0,buttonOk:!0,autoDestroy:!0})},this)})}});$(function(){function a(d){d=$(d);b();f();g();if(1<d.length)return d.each(function(b,c){a(c)}),d;d.attr("autocomplete","off");d.on("focusin",function(){var a=$("#sg").data("sg_keyword");a&&a.get(0)!==d.get(0)&&g();""==$("#sg").html()||h()||e(d);t.musttype||""==$("#sg").html()&&""!=d.val().replace(/ /g,"")&&c(d)});d.on("focusout",function(){h()&&0==y&&f()});d.on("keydown",function(a){if(!a.ctrlKey&&!a.altKey){var b=a.keyCode?a.keyCode:a.which;9==b&&a.shiftKey&&(b=38);switch(b){case 13:if(!h()||!$("#sg ul li").is(".sg-hl"))return;
$("#sg ul li.sg-hl").trigger("click");a.preventDefault();return;case 16:return;case 37:case 39:if(t.leftright)break;else return;case 38:if(h())k(d,-1),a.preventDefault();else if(t.leftright)break;return;case 40:case 9:if(h())k(d,1),a.preventDefault();else if(t.leftright&&9!=b)break;return;case 27:h()&&(f(),a.preventDefault());return;case 33:h()&&("group"==p[0].type?n(d,1):n(d,0),a.preventDefault());return;case 34:h()&&(n(d,p.length-1),a.preventDefault());return}c(d)}});d.on("paste",function(a){c(d)});
$(window).on("unload",function(){d.removeAttr("autocomplete")});return d}function b(){var a=$("#sg");a.length||(a=$("<div/>",{id:"sg"}),a.css("visibility","hidden"),$("body").append(a));a.data("prepared")||(a.data("prepared",1),a.on("click","li",function(a){if((sg_keyword=$("#sg").data("sg_keyword"))&&sg_keyword.length){sg_keyword.trigger("focus");a.stopImmediatePropagation();a=$(this).prevAll("li").length;a=p[a];$("#sg ul li").removeClass("sg-hl");if("group"==a.type)return u=-1,!1;clearTimeout(z);
$(this).addClass("sg-hl");"message"!=a.type&&sg_keyword.removeAttr("autocomplete");f();switch(a.type){case "search":case "product":case "link":sg_keyword.val(a.keyword||a.content_full||a.content),a.url?document.location.href=a.url:sg_keyword.parents("form").trigger("submit")}return!1}}),a.on("mouseenter","li",function(){!(sg_keyword=$("#sg").data("sg_keyword"))||!sg_keyword.length||0<=$(this).attr("class").indexOf("grp")||($("#sg ul li").removeClass("sg-hl"),$(this).addClass("sg-hl"),u=$(this).prevAll("li").length,
sg_keyword.val()!=v&&sg_keyword.val(v))}),a.on("mouseleave","li",function(){$(this).removeClass("sg-hl");u=-1}),a.on("mouseenter",function(){y=1}).on("mouseleave",function(){y=0}),$(window).on("resize",l))}function c(a){a.data("disabled")||(clearTimeout(z),z=setTimeout(function(){d(a)},t.delay))}function d(a){v=a.val();var b=v.replace(/  +/g," ").replace(/^ | $/g,"");if(b!=x)if(x=b,""==b)f(),g();else{var c;c=window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP");c.onreadystatechange=
function(){if(4==c.readyState&&200==c.status&&(r=JSON.parse(c.responseText),void 0!=r.input&&void 0!=r.keywords&&!(void 0==r.seq||r.seq<A)))if(A=r.seq,r.disabled)a.data("disabled",!0),a.removeAttr("autocomplete"),f(),g();else{p.length=0;if(void 0!=r.groups&&""!=r.groups)for(var b=0,d=r.groups.length;b<d;b++){var h=r.groups[b].elements,k=r.groups[b].title;if(h&&""!=h)for(k&&""!=k&&p.push({type:"group",title:k}),h=0,k=r.groups[b].elements.length;h<k;h++)p.push(r.groups[b].elements[h])}b="";if(0<p.length)for(h=
0,k=p.length;h<k;h++)switch(d=p[h],d.type){case "group":b+='<li class="grp">'+d.title+"</li>";break;case "search":b+=m("<li/>",d.content,{"class":"src",title:d.content_full||""});break;case "product":var l="";void 0!=d.image?l='<img src="'+d.image+'">':t.noimage&&(l='<img src="/images/search-suggest-noimage.png">');b+='<li class="prd"><table><tr><td>'+l+"</td><td>&nbsp;&nbsp;</td><td>"+m("<p/>",d.content,{title:d.content_full||""})+"</td></tr></table></li>\n";break;case "link":b+='<li class="lnk">'+
m("<a/>",d.content||d.url,{href:d.url,title:d.content_full||""})+"</li>\n";break;case "html":b+='<li class="htm">'+d.content+"</li>\n"}t.none&&""==b&&(b+='<li class="msg">No hay sugerencias</li>\n',p.push({type:"message"}));""==b?(f(),g()):($("#sg").html("<ul>"+b+"</ul>"),e(a),u=-1)}};c.open("GET","/api/search-suggest.json?q="+encodeURIComponent(b)+"&seq="+ ++C,!0);c.send()}}function e(a){-1==u&&$("#sg ul li").removeClass("sg-hl");var b=$("#sg");b.data("sg_keyword",a);l();b.css("visibility","visible");
fmask_show(document.getElementById("sg"))}function f(){$("#sg").css("visibility","hidden");fmask_hide()}function g(){$("#sg").html("");x="";u=-1}function h(){return"visible"==$("#sg").css("visibility")?1:0}function l(){var a=$("#sg").data("sg_keyword");a&&$("#sg").css({left:a.offset().left,top:a.offset().top+a.outerHeight(!1)})}function m(a,b,c){if(t.bold){var d=r.keywords.split(" "),e=String.fromCharCode(1),f=String.fromCharCode(2),g;for(g in d){var h=d[g].replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|\&]/g,
"\\$&");b=b.replace(new RegExp("(^|\\W)("+h+")","ig"),"$1"+e+"$2"+f)}}e=$("<span/>").text(b).html().replace(new RegExp(e,"g"),"<b>").replace(new RegExp(f,"g"),"</b>");return $("<span/>").append($(a,c).html(e)).html()}function k(a,b){if(!(1>p.length)){if(0<b){var c=u+1;c<p.length&&"group"==p[c].type&&c++;if(c>=p.length)if(t.loop)c=-1;else return}if(0>b&&(c=u-1,0<=c&&"group"==p[c].type&&c--,-1>c))if(t.loop)c=p.length-1;else return;n(a,c)}}function n(a,b){$("#sg ul li").removeClass("sg-hl");var c=p[b];
0<=b?a.val(c.keyword||c.content_full||c.content):a.val(v);0<=b&&$("#sg ul li:eq("+b+")").addClass("sg-hl");u=b}var t={loop:1,bold:1,noimage:1,none:1,musttype:1,leftright:1,delay:200},v="",x="",p=[],u=-1,A=0,C=0,z=0,y=0,r;a($(".search-suggest"));new function(a){a.fn.setCursorPosition=function(b){a(this).get(0).setSelectionRange?a(this).get(0).setSelectionRange(b,b):a(this).get(0).createTextRange&&a(this).get(0).createTextRange().collapse(!0).moveEnd("character",b).moveStart("character",b).select()}}(jQuery)});$(function(){$("#admin-notes").on("click",function(a){$(a.target).closest("a").length||$("#admin-notes").remove()})});$(function(){$(".action-auth-keep").each(function(){var a=$(this),b=a.attr("data-auth-renew")||600,c=a.attr("data-auth-events")||"click change focusin",d=a.attr("data-auth-type")||"customer",e=!1;a.on(c,function(a){e=!0});setInterval(function(){e&&(rshJSON("/api/xtauth.json",{opcode:"check",submode:"renew",type:d},function(a){}),e=!1)},1E3*b)})});$(function(){$(document.body).on("click",".action-confirm",function(a){a.preventDefault();a.stopPropagation();$(a.target).closest(".action-confirm").confirm({event:a})})});$(function(){$(document.body).on("click",".action-media-view",function(a){var b=$(a.target).closest(".action-media-view"),c=b.attr("data-media-id");if(c)if("pdf"==b.attr("data-media-mime-short"))"A"!=b.prop("nodeName")&&(a.preventDefault(),window.open("/api/media-view.url?id="+c+"&format=wm-asis/pr-asis"));else{c={current:b};b.attr("data-media-list")&&(c.list=b.attr("data-media-list"));b.attr("data-media-skip-pdf")&&(c.skipPDF=!0);a.preventDefault();var d=$("<div/>");d.dialog({title:b.attr("data-media-title"),
content:"<div></div>",width:750,height:680,modal:!0,closeOnEscape:!0,autoOpen:!1,autoDestroy:!0,close:function(){d.mediaView("destroy")}});d.mediaView(c);d.dialog("open")}else console.warn("Action-media-view has no media ID")})});$(function(){$(document.body).on("click",".action-popup",function(a){var b=$(a.target),c=b.attr("data-popup-title"),d=b.closest(".action-popup").attr("data-popup-id"),e=b.closest(".action-popup").attr("data-popup-template-code"),f={title:c,modal:!0,closeOnEscape:!0,autoOpen:!0,buttonOk:!0};b.attr("data-popup-width")&&(f.width=b.attr("data-popup-width"));b.attr("data-popup-height")&&(f.height=b.attr("data-popup-height"));d?(a.preventDefault(),$("#"+d).dialog(f)):e&&(a.preventDefault(),TemplateFactory.get({code:e,
loadingOk:!0,onready:function(a){$(a()).dialog(f)}}))})});$(function(){$(document.body).on("click",".action-print-page",function(a){a.preventDefault();window.print()});setTimeout(function(){urlParams().printable&&window.print()},1500)});$(function(){function a(a,c){if(null==a||"plaintext"==c)return a;if("hxr"==c){for(var d="",e=a.length;0<e;e-=2)d+=String.fromCharCode(149^parseInt(a.substr(e-2,2),16));return decodeURIComponent(escape(d))}}$(".data-obfuscate").each(function(b){b=$(this);var c=b.attr("data-o-alg")||"hxr",d=b.attr("data-o-value-text"),d=a(d,c),e=b.attr("data-o-value-attr"),c=a(e,c);null!=d&&b.text(d);null!=c&&b.attr(b.attr("data-o-attr")||"href",c)})});
//# sourceMappingURL=/js/min/rsh-ui.map
